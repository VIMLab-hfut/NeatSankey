<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<title>SANKEY Experiment</title>
<style>
    /**{*/
    /*    z-index: 0*/
    /*}*/
    .node rect {
        /*cursor: move;*/
        fill-opacity: .9;
        shape-rendering: crispEdges;
    }

    .node text {
        pointer-events: none;
        text-shadow: 0 1px 0 #fff;
    }

    .link {
        fill: none;
        stroke: #000; /*#CCCCCC;*/
        stroke-opacity: 0.2;
    }

    .link:hover {
        stroke: #000000;
        stroke-opacity: .5;
    }

</style>

<body>

<p id="chart" style="text-align: center; transform: scale(1.2, 1) translateX(200px)">

    <script src="http://d3js.org/d3.v3.js"></script>
    <script>

        d3.sankey = function () {
            var sankey = {},
                nodeWidth = 24,
                nodePadding = 8,
                size = [1, 1],
                nodes = [],
                links = [];

            sankey.nodeWidth = function (_) {
                if (!arguments.length) return nodeWidth;
                nodeWidth = +_;
                return sankey;
            };

            sankey.nodePadding = function (_) {
                if (!arguments.length) return nodePadding;
                nodePadding = +_;
                return sankey;
            };

            sankey.nodes = function (_) {
                if (!arguments.length) return nodes;
                nodes = _;
                return sankey;
            };

            sankey.links = function (_) {
                if (!arguments.length) return links;
                links = _;
                return sankey;
            };

            sankey.size = function (_) {
                if (!arguments.length) return size;
                size = _;
                return sankey;
            };

            sankey.layout = function (iterations) {
                computeNodeLinks();
                computeNodeValues();
                computeNodeBreadths();
                computeNodeDepths(iterations);
                computeLinkDepths();
                return sankey;
            };

            sankey.relayout = function () {
                computeLinkDepths();
                return sankey;
            };

            sankey.link = function () {
                var curvature = .5;

                function link(d) {
                    var x0 = d.source.x + d.source.dx,
                        x1 = d.target.x,
                        xi = d3.interpolateNumber(x0, x1),
                        x2 = xi(curvature),
                        x3 = xi(1 - curvature),
                        y0 = d.source.y + d.sy + d.dy / 2,
                        y1 = d.target.y + d.ty + d.dy / 2;
                    return "M" + x0 + "," + y0
                        + "C" + x2 + "," + y0
                        + " " + x3 + "," + y1
                        + " " + x1 + "," + y1;
                }

                link.curvature = function (_) {
                    if (!arguments.length) return curvature;
                    curvature = +_;
                    return link;
                };

                return link;
            };

            // Populate the sourceLinks and targetLinks for each node.
            // Also, if the source and target are not objects, assume they are indices.
            function computeNodeLinks() {
                nodes.forEach(function (node) {
                    node.sourceLinks = [];
                    node.targetLinks = [];
                });
                links.forEach(function (link) {
                    var source = link.source,
                        target = link.target;
                    if (typeof source === "number") source = link.source = nodes[link.source];
                    if (typeof target === "number") target = link.target = nodes[link.target];
                    source.sourceLinks.push(link);
                    target.targetLinks.push(link);
                });
            }

            // Compute the value (size) of each node by summing the associated links.
            function computeNodeValues() {
                nodes.forEach(function (node) {
                    node.value = Math.max(
                        d3.sum(node.sourceLinks, value),
                        d3.sum(node.targetLinks, value)
                    );
                });
            }

            // Iteratively assign the breadth (x-position) for each node.
            // Nodes are assigned the maximum breadth of incoming neighbors plus one;
            // nodes with no incoming links are assigned breadth zero, while
            // nodes with no outgoing links are assigned the maximum breadth.
            function computeNodeBreadths() {
                const startX = level[0][0].x
                const endX = level[level.length - 1][0].x + 36
                const realWidth = endX - startX
                // let startPlace = level[0][0].x / realWidth * 1400 - 30

                nodes.forEach(function (node) {
                    // for (let m =0 ;m< level.length; m++)
                    //     for (let n = 0;n< level[m].length; n++)
                    //         if (level[m][n].name === node.name) {
                    //             node.x = level[m][n].x
                    //             node.y = level[m][n].y
                    //         }
                    node.x = (node.x - startX) / realWidth * 1400// - startPlace
                    node.dx = nodeWidth
                })
                // var remainingNodes = nodes,
                //     nextNodes,
                //     x = 0;
                //
                // while (remainingNodes.length) {
                //     nextNodes = [];
                //     remainingNodes.forEach(function (node) {
                //         node.x = x;
                //         node.dx = nodeWidth;
                //         node.sourceLinks.forEach(function (link) {
                //             nextNodes.push(link.target);
                //         });
                //     });
                //     remainingNodes = nextNodes;
                //     ++x;
                // }
                //
                // //
                // // moveSinksRight(x);
                // scaleNodeBreadths((size[0] - nodeWidth) / (x - 1));
            }

            function computeNodeDepths(iterations) {
                var nodesByBreadth = d3.nest()
                    .key(function (d) {
                        return d.x;
                    })
                    .sortKeys(d3.ascending)
                    .entries(nodes)
                    .map(function (d) {
                        return d.values;
                    });

                initializeNodeDepth();
                resolveCollisions();

                // relaxLeftToRight(1);
                // resolveCollisions();
                //
                // for (var alpha = 0.001; iterations > 0; --iterations) {
                //     relaxRightToLeft(alpha *= .99);
                //     resolveCollisions();
                //     relaxLeftToRight(alpha);
                //     resolveCollisions();
                // }

                function initializeNodeDepth() {
                    // var ky = d3.min(nodesByBreadth, function (nodes) {
                    //     return (size[1] - (nodes.length - 1) * nodePadding) / d3.sum(nodes, value);
                    // });
                    var ky = 4

                    nodesByBreadth.forEach(function (nodes) {
                        nodes.forEach(function (node, i) {
                            // node.y = i;
                            node.dy = node.value * ky;
                        });
                    });

                    links.forEach(function (link) {
                        link.dy = link.value * ky;
                    });
                }

                function resolveCollisions() {
                    nodesByBreadth.forEach(function (nodes) {
                        var node,
                            dy,
                            y0 = 0,
                            n = nodes.length,
                            i;

                        // Push any overlapping nodes down.
                        nodes.sort(ascendingDepth);
                        for (i = 0; i < n; ++i) {
                            node = nodes[i];
                            dy = y0 - node.y;
                            if (dy > 0) node.y += dy;
                            y0 = node.y + node.dy + nodePadding;
                        }

                        // If the bottommost node goes outside the bounds, push it back up.
                        dy = y0 - nodePadding - size[1];
                        if (dy > 0) {
                            y0 = node.y -= dy;

                            // Push any overlapping nodes back up.
                            for (i = n - 2; i >= 0; --i) {
                                node = nodes[i];
                                dy = node.y + node.dy + nodePadding - y0;
                                if (dy > 0) node.y -= dy;
                                y0 = node.y;
                            }
                        }
                    });
                }

                function ascendingDepth(a, b) {
                    return a.y - b.y;
                }

                function relaxLeftToRight(alpha) {
                    nodesByBreadth.forEach(function (nodes, breadth) {
                        nodes.forEach(function (node) {
                            if (node.targetLinks.length) {
                                var y = d3.sum(node.targetLinks, weightedSource) / d3.sum(node.targetLinks, value);
                                node.y += (y - center(node)) * alpha;
                            }
                        });
                    });

                    function weightedSource(link) {
                        return center(link.source) * link.value;
                    }
                }

                function relaxRightToLeft(alpha) {
                    nodesByBreadth.slice().reverse().forEach(function (nodes) {
                        nodes.forEach(function (node) {
                            if (node.sourceLinks.length) {
                                var y = d3.sum(node.sourceLinks, weightedTarget) / d3.sum(node.sourceLinks, value);
                                node.y += (y - center(node)) * alpha;
                            }
                        });
                    });

                    function weightedTarget(link) {
                        return center(link.target) * link.value;
                    }
                }
            }

            function computeLinkDepths() {
                nodes.forEach(function (node) {
                    node.sourceLinks.sort(ascendingTargetDepth);
                    node.targetLinks.sort(ascendingSourceDepth);
                });
                nodes.forEach(function (node) {
                    var sy = 0, ty = 0;
                    node.sourceLinks.forEach(function (link) {
                        link.sy = sy;
                        sy += link.dy;
                    });
                    node.targetLinks.forEach(function (link) {
                        link.ty = ty;
                        ty += link.dy;
                    });
                });

                function ascendingSourceDepth(a, b) {
                    return a.source.y - b.source.y;
                }

                function ascendingTargetDepth(a, b) {
                    return a.target.y - b.target.y;
                }
            }

            function center(node) {
                return node.y + node.dy / 2;
            }

            function value(link) {
                return link.value;
            }

            return sankey;
        };

        var units = "Widgets";

        var margin = {top: 10, right: 10, bottom: 10, left: 10},
            width = 1820 - margin.left - margin.right,
            // width = 2500 - margin.left - margin.right,
            height = 1460 - margin.top - margin.bottom;

        var formatNumber = d3.format(",.0f"),    // zero decimal places
            format = function (d) {
                return formatNumber(d) + " " + units;
            },
            color = d3.scale.category20();

        // append the svg canvas to the page
        var svg = d3.select("#chart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Set the sankey diagram properties
        var sankey = d3.sankey()
            .nodeWidth(36)
            .nodePadding(10)
            .size([width, height]);

        var path = sankey.link();

        let links = [{"source": "L0N0", "target": "L1N6", "value": 23.03030303030303}, {"source": "L0N0", "target": "L1N12", "value": 13.181818181818182}, {"source": "L0N0", "target": "L1N19", "value": 0.4545454545454546}, {"source": "L0N0", "target": "L1N16", "value": 0.4545454545454546}, {"source": "L0N0", "target": "L1N20", "value": 0.30303030303030304}, {"source": "L0N0", "target": "L1N18", "value": 0.30303030303030304}, {"source": "L0N0", "target": "L1N2", "value": 0.30303030303030304}, {"source": "L0N0", "target": "L1N8", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N22", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N9", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N24", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N26", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N21", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N4", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N11", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N27", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N0", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N23", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N25", "value": 0.15151515151515152}, {"source": "L0N0", "target": "L1N14", "value": 0.15151515151515152}, {"source": "L1N6", "target": "L2N19", "value": 0.15151515151515152}, {"source": "L1N12", "target": "L2N0", "value": 0.15151515151515152}, {"source": "L1N19", "target": "L2N7", "value": 0.15151515151515152}, {"source": "L1N16", "target": "L2N13", "value": 0.15151515151515152}, {"source": "L1N20", "target": "L2N4", "value": 0.15151515151515152}, {"source": "L1N18", "target": "L2N17", "value": 0.15151515151515152}, {"source": "L1N2", "target": "L2N16", "value": 0.30303030303030304}, {"source": "L1N8", "target": "L2N0", "value": 0.15151515151515152}, {"source": "L1N22", "target": "L2N9", "value": 0.15151515151515152}, {"source": "L1N9", "target": "L2N14", "value": 0.15151515151515152}, {"source": "L1N24", "target": "L2N14", "value": 0.15151515151515152}, {"source": "L1N26", "target": "L2N19", "value": 0.15151515151515152}, {"source": "L1N21", "target": "L2N2", "value": 0.15151515151515152}, {"source": "L1N4", "target": "L2N17", "value": 0.15151515151515152}, {"source": "L1N11", "target": "L2N14", "value": 0.15151515151515152}, {"source": "L1N27", "target": "L2N21", "value": 0.15151515151515152}, {"source": "L1N0", "target": "L2N15", "value": 20.454545454545457}, {"source": "L1N0", "target": "L2N3", "value": 8.636363636363637}, {"source": "L1N0", "target": "L2N0", "value": 0.6060606060606061}, {"source": "L1N0", "target": "L2N17", "value": 5.303030303030303}, {"source": "L1N0", "target": "L2N20", "value": 0.4545454545454546}, {"source": "L1N0", "target": "L2N6", "value": 2.5757575757575757}, {"source": "L1N0", "target": "L2N11", "value": 0.15151515151515152}, {"source": "L1N23", "target": "L2N16", "value": 0.15151515151515152}, {"source": "L1N25", "target": "L2N6", "value": 0.15151515151515152}, {"source": "L1N14", "target": "L2N14", "value": 0.15151515151515152}, {"source": "L0N1", "target": "L1N22", "value": 1.3636363636363638}, {"source": "L0N2", "target": "L1N19", "value": 1.0606060606060606}, {"source": "L0N3", "target": "L1N26", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N8", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N13", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N14", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N2", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N23", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N19", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N7", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N16", "value": 0.15151515151515152}, {"source": "L0N3", "target": "L1N3", "value": 0.15151515151515152}, {"source": "L1N13", "target": "L2N9", "value": 0.15151515151515152}, {"source": "L1N7", "target": "L2N21", "value": 0.15151515151515152}, {"source": "L1N3", "target": "L2N0", "value": 0.15151515151515152}, {"source": "L0N4", "target": "L1N2", "value": 0.30303030303030304}, {"source": "L0N5", "target": "L1N17", "value": 0.15151515151515152}, {"source": "L1N17", "target": "L2N8", "value": 0.15151515151515152}, {"source": "L0N6", "target": "L1N19", "value": 0.15151515151515152}, {"source": "L0N7", "target": "L1N11", "value": 0.15151515151515152}, {"source": "L0N8", "target": "L1N13", "value": 0.15151515151515152}, {"source": "L0N9", "target": "L1N8", "value": 0.15151515151515152}, {"source": "L0N10", "target": "L1N14", "value": 0.15151515151515152}, {"source": "L0N11", "target": "L1N0", "value": 0.15151515151515152}, {"source": "L0N12", "target": "L1N6", "value": 0.15151515151515152}, {"source": "L0N13", "target": "L1N12", "value": 0.15151515151515152}, {"source": "L0N14", "target": "L1N21", "value": 0.15151515151515152}, {"source": "L0N15", "target": "L1N12", "value": 0.15151515151515152}, {"source": "L0N16", "target": "L1N18", "value": 0.15151515151515152}, {"source": "L0N17", "target": "L1N21", "value": 0.15151515151515152}, {"source": "L0N18", "target": "L1N0", "value": 0.15151515151515152}, {"source": "L0N19", "target": "L1N6", "value": 0.15151515151515152}, {"source": "L0N20", "target": "L1N8", "value": 0.15151515151515152}, {"source": "L2N15", "target": "L3N3", "value": 0.15151515151515152}, {"source": "L2N3", "target": "L3N6", "value": 0.30303030303030304}, {"source": "L2N3", "target": "L3N10", "value": 0.15151515151515152}, {"source": "L2N3", "target": "L3N7", "value": 0.15151515151515152}, {"source": "L2N3", "target": "L3N1", "value": 0.15151515151515152}, {"source": "L2N3", "target": "L3N0", "value": 0.15151515151515152}, {"source": "L2N0", "target": "L3N6", "value": 0.15151515151515152}, {"source": "L2N0", "target": "L3N10", "value": 1.0606060606060606}, {"source": "L2N0", "target": "L3N1", "value": 0.4545454545454546}, {"source": "L2N0", "target": "L3N7", "value": 0.30303030303030304}, {"source": "L2N0", "target": "L3N4", "value": 0.15151515151515152}, {"source": "L2N0", "target": "L3N0", "value": 0.15151515151515152}, {"source": "L2N0", "target": "L3N5", "value": 0.15151515151515152}, {"source": "L2N0", "target": "L3N11", "value": 0.15151515151515152}, {"source": "L2N0", "target": "L3N8", "value": 0.15151515151515152}, {"source": "L2N0", "target": "L3N9", "value": 0.15151515151515152}, {"source": "L2N17", "target": "L3N4", "value": 0.15151515151515152}, {"source": "L2N20", "target": "L3N10", "value": 0.15151515151515152}, {"source": "L2N6", "target": "L3N5", "value": 0.15151515151515152}, {"source": "L2N11", "target": "L3N2", "value": 0.15151515151515152}, {"source": "L1N1", "target": "L2N23", "value": 0.15151515151515152}, {"source": "L1N1", "target": "L2N18", "value": 0.15151515151515152}, {"source": "L1N1", "target": "L2N10", "value": 0.15151515151515152}, {"source": "L1N1", "target": "L2N12", "value": 0.15151515151515152}, {"source": "L1N1", "target": "L2N5", "value": 0.15151515151515152}, {"source": "L1N1", "target": "L2N1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "L2N22", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N15->V1", "value": 0.6060606060606061}, {"source": "L1N1", "target": "dummy->L1N1->L2N7->V1", "value": 0.30303030303030304}, {"source": "L1N1", "target": "dummy->L1N1->L2N11->V1", "value": 0.6060606060606061}, {"source": "L1N1", "target": "dummy->L1N1->L2N14->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N0->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N21->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N3->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N8->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N20->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N9->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N2->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N6->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N4->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N16->V1", "value": 0.15151515151515152}, {"source": "L1N1", "target": "dummy->L1N1->L2N13->V1", "value": 0.15151515151515152}, {"source": "L2N7", "target": "L3N3", "value": 0.30303030303030304}, {"source": "L2N14", "target": "L3N9", "value": 0.15151515151515152}, {"source": "L2N21", "target": "L3N10", "value": 0.15151515151515152}, {"source": "L2N23", "target": "dummy->L2N23->L3N9->V2", "value": 0.15151515151515152}, {"source": "L2N18", "target": "dummy->L2N18->L3N6->V2", "value": 0.15151515151515152}, {"source": "L2N10", "target": "dummy->L2N10->L3N0->V2", "value": 0.15151515151515152}, {"source": "L2N8", "target": "L3N6", "value": 0.15151515151515152}, {"source": "L2N9", "target": "L3N5", "value": 0.15151515151515152}, {"source": "L2N2", "target": "L3N6", "value": 0.9090909090909092}, {"source": "L2N2", "target": "L3N10", "value": 0.4545454545454546}, {"source": "L2N2", "target": "L3N2", "value": 0.30303030303030304}, {"source": "L2N2", "target": "L3N7", "value": 0.15151515151515152}, {"source": "L2N2", "target": "L3N1", "value": 0.15151515151515152}, {"source": "L2N2", "target": "L3N4", "value": 0.15151515151515152}, {"source": "L2N2", "target": "L3N11", "value": 0.15151515151515152}, {"source": "L2N2", "target": "L3N3", "value": 0.15151515151515152}, {"source": "L2N2", "target": "L3N9", "value": 0.15151515151515152}, {"source": "L2N12", "target": "dummy->L2N12->L3N11->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N6->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N10->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N1->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N0->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N5->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N11->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N3->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N8->V2", "value": 0.15151515151515152}, {"source": "L2N5", "target": "dummy->L2N5->L3N9->V2", "value": 0.15151515151515152}, {"source": "L2N4", "target": "L3N0", "value": 0.7575757575757576}, {"source": "L2N4", "target": "L3N3", "value": 0.30303030303030304}, {"source": "L2N1", "target": "dummy->L2N1->L3N6->V2", "value": 25.606060606060606}, {"source": "L2N1", "target": "dummy->L2N1->L3N2->V2", "value": 7.272727272727273}, {"source": "L2N1", "target": "dummy->L2N1->L3N10->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N7->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N1->V2", "value": 0.6060606060606061}, {"source": "L2N1", "target": "dummy->L2N1->L3N4->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N0->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N5->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N11->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N3->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N8->V2", "value": 0.15151515151515152}, {"source": "L2N1", "target": "dummy->L2N1->L3N9->V2", "value": 0.15151515151515152}, {"source": "L2N16", "target": "L3N9", "value": 0.15151515151515152}, {"source": "L2N22", "target": "dummy->L2N22->L3N1->V2", "value": 0.15151515151515152}, {"source": "L2N13", "target": "L3N9", "value": 0.15151515151515152}, {"source": "L1N5", "target": "dummy->L1N5->L2N16->V1", "value": 0.15151515151515152}, {"source": "L2N19", "target": "L3N4", "value": 0.15151515151515152}, {"source": "L1N10", "target": "dummy->L1N10->L2N11->V1", "value": 0.15151515151515152}, {"source": "L1N15", "target": "L2N23", "value": 0.15151515151515152}, {"source": "L3N6", "target": "L4N23", "value": 0.30303030303030304}, {"source": "L3N10", "target": "L4N16", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N32", "value": 0.30303030303030304}, {"source": "L3N1", "target": "L4N25", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N28", "value": 0.6060606060606061}, {"source": "L3N1", "target": "L4N27", "value": 0.30303030303030304}, {"source": "L3N1", "target": "L4N4", "value": 0.30303030303030304}, {"source": "L3N1", "target": "L4N26", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N33", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N15", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N34", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N7", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N29", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N1", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N13", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N14", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N37", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N19", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N22", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N31", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N36", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N12", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N5", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N24", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N8", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N20", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N2", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N18", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N16", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N23", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N0", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N3", "value": 0.15151515151515152}, {"source": "L3N1", "target": "L4N9", "value": 0.15151515151515152}, {"source": "L3N7", "target": "L4N33", "value": 0.30303030303030304}, {"source": "L3N4", "target": "L4N14", "value": 0.15151515151515152}, {"source": "L3N4", "target": "L4N23", "value": 0.15151515151515152}, {"source": "L3N4", "target": "L4N0", "value": 0.30303030303030304}, {"source": "L3N0", "target": "L4N21", "value": 8.030303030303031}, {"source": "L3N0", "target": "L4N22", "value": 7.121212121212121}, {"source": "L3N0", "target": "L4N28", "value": 9.545454545454545}, {"source": "L3N0", "target": "L4N36", "value": 1.2121212121212122}, {"source": "L3N0", "target": "L4N12", "value": 8.636363636363637}, {"source": "L3N0", "target": "L4N18", "value": 0.15151515151515152}, {"source": "L3N0", "target": "L4N16", "value": 1.0606060606060606}, {"source": "L3N0", "target": "L4N5", "value": 0.15151515151515152}, {"source": "L3N0", "target": "L4N37", "value": 0.30303030303030304}, {"source": "L3N0", "target": "L4N19", "value": 0.15151515151515152}, {"source": "L3N0", "target": "L4N15", "value": 0.30303030303030304}, {"source": "L3N0", "target": "L4N9", "value": 0.15151515151515152}, {"source": "L3N5", "target": "L4N19", "value": 0.15151515151515152}, {"source": "L3N5", "target": "L4N22", "value": 0.15151515151515152}, {"source": "L3N11", "target": "L4N7", "value": 0.15151515151515152}, {"source": "L3N8", "target": "L4N18", "value": 0.15151515151515152}, {"source": "L3N9", "target": "L4N30", "value": 0.15151515151515152}, {"source": "L3N2", "target": "L4N2", "value": 0.30303030303030304}, {"source": "L3N2", "target": "L4N20", "value": 0.15151515151515152}, {"source": "L3N2", "target": "L4N18", "value": 0.15151515151515152}, {"source": "L3N2", "target": "L4N8", "value": 0.15151515151515152}, {"source": "L3N3", "target": "L4N21", "value": 1.3636363636363638}, {"source": "L2N24", "target": "dummy->L2N24->L3N6->V1", "value": 0.15151515151515152}, {"source": "L4N21", "target": "L5N6", "value": 0.15151515151515152}, {"source": "L4N22", "target": "L5N16", "value": 0.15151515151515152}, {"source": "L4N28", "target": "L5N12", "value": 0.15151515151515152}, {"source": "L4N36", "target": "L5N11", "value": 0.15151515151515152}, {"source": "L4N12", "target": "L5N15", "value": 0.15151515151515152}, {"source": "L4N18", "target": "L5N14", "value": 0.15151515151515152}, {"source": "L4N16", "target": "L5N3", "value": 0.15151515151515152}, {"source": "L4N5", "target": "L5N4", "value": 0.15151515151515152}, {"source": "L4N37", "target": "L5N0", "value": 0.15151515151515152}, {"source": "L4N19", "target": "L5N7", "value": 0.15151515151515152}, {"source": "L4N15", "target": "L5N5", "value": 0.15151515151515152}, {"source": "L4N9", "target": "L5N1", "value": 0.15151515151515152}, {"source": "L4N32", "target": "L5N14", "value": 0.15151515151515152}, {"source": "L4N25", "target": "L5N4", "value": 0.15151515151515152}, {"source": "L4N27", "target": "L5N10", "value": 0.15151515151515152}, {"source": "L4N4", "target": "L5N7", "value": 0.30303030303030304}, {"source": "L4N26", "target": "L5N14", "value": 0.15151515151515152}, {"source": "L4N33", "target": "L5N14", "value": 0.15151515151515152}, {"source": "L4N34", "target": "L5N13", "value": 0.15151515151515152}, {"source": "L4N7", "target": "L5N15", "value": 0.15151515151515152}, {"source": "L4N29", "target": "L5N0", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N20", "value": 0.30303030303030304}, {"source": "L4N1", "target": "L5N1", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N4", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N8", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N12", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N5", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N3", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N10", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N14", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N9", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N17", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N7", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N16", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N13", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N0", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N15", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N18", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N11", "value": 0.15151515151515152}, {"source": "L4N1", "target": "L5N2", "value": 0.15151515151515152}, {"source": "L4N13", "target": "L5N13", "value": 0.15151515151515152}, {"source": "L4N14", "target": "L5N14", "value": 0.15151515151515152}, {"source": "L4N31", "target": "L5N2", "value": 0.15151515151515152}, {"source": "L4N24", "target": "L5N1", "value": 0.15151515151515152}, {"source": "L4N8", "target": "L5N16", "value": 0.15151515151515152}, {"source": "L4N20", "target": "L5N4", "value": 0.15151515151515152}, {"source": "L4N2", "target": "L5N1", "value": 29.242424242424242}, {"source": "L4N2", "target": "L5N0", "value": 5.606060606060606}, {"source": "L4N2", "target": "L5N9", "value": 0.30303030303030304}, {"source": "L4N2", "target": "L5N15", "value": 0.15151515151515152}, {"source": "L4N2", "target": "L5N17", "value": 0.15151515151515152}, {"source": "L4N2", "target": "L5N10", "value": 0.15151515151515152}, {"source": "L4N2", "target": "L5N12", "value": 0.15151515151515152}, {"source": "L4N2", "target": "L5N8", "value": 0.15151515151515152}, {"source": "L4N2", "target": "L5N5", "value": 0.15151515151515152}, {"source": "L4N2", "target": "L5N19", "value": 0.15151515151515152}, {"source": "L4N23", "target": "L5N20", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N20", "value": 0.4545454545454546}, {"source": "L4N0", "target": "L5N13", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N1", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N4", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N9", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N17", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N10", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N12", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N11", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N14", "value": 0.15151515151515152}, {"source": "L4N0", "target": "L5N6", "value": 0.15151515151515152}, {"source": "L4N3", "target": "L5N8", "value": 0.15151515151515152}, {"source": "L4N30", "target": "L5N4", "value": 0.15151515151515152}, {"source": "L5N20", "target": "L6N2", "value": 0.15151515151515152}, {"source": "L5N13", "target": "L6N3", "value": 0.15151515151515152}, {"source": "L5N1", "target": "L6N3", "value": 4.242424242424242}, {"source": "L5N1", "target": "L6N1", "value": 2.272727272727273}, {"source": "L5N1", "target": "L6N2", "value": 0.9090909090909092}, {"source": "L5N1", "target": "L6N0", "value": 0.15151515151515152}, {"source": "L5N4", "target": "L6N3", "value": 2.121212121212121}, {"source": "L5N4", "target": "L6N1", "value": 0.30303030303030304}, {"source": "L5N9", "target": "L6N0", "value": 0.15151515151515152}, {"source": "L5N17", "target": "L6N3", "value": 0.15151515151515152}, {"source": "L5N10", "target": "L6N0", "value": 0.15151515151515152}, {"source": "L5N12", "target": "L6N0", "value": 0.15151515151515152}, {"source": "L5N11", "target": "L6N3", "value": 0.15151515151515152}, {"source": "L5N14", "target": "L6N2", "value": 0.15151515151515152}, {"source": "L5N6", "target": "L6N3", "value": 1.0606060606060606}, {"source": "L5N6", "target": "L6N1", "value": 0.4545454545454546}, {"source": "L5N8", "target": "L6N2", "value": 0.15151515151515152}, {"source": "L5N5", "target": "L6N1", "value": 0.15151515151515152}, {"source": "L5N3", "target": "L6N3", "value": 4.090909090909091}, {"source": "L5N7", "target": "L6N2", "value": 0.15151515151515152}, {"source": "L5N16", "target": "L6N3", "value": 0.15151515151515152}, {"source": "L5N0", "target": "L6N0", "value": 6.818181818181818}, {"source": "L5N0", "target": "L6N1", "value": 0.6060606060606061}, {"source": "L5N0", "target": "L6N2", "value": 0.7575757575757576}, {"source": "L5N15", "target": "L6N2", "value": 0.15151515151515152}, {"source": "L5N18", "target": "L6N0", "value": 0.15151515151515152}, {"source": "L5N2", "target": "L6N3", "value": 20.606060606060606}, {"source": "L5N19", "target": "L6N1", "value": 0.15151515151515152}, {"source": "L4N6", "target": "dummy->L4N6->L5N20->V1", "value": 0.15151515151515152}, {"source": "L4N10", "target": "dummy->L4N10->L5N11->V1", "value": 0.15151515151515152}, {"source": "L4N11", "target": "dummy->L4N11->L5N18->V1", "value": 0.15151515151515152}, {"source": "L4N17", "target": "dummy->L4N17->L5N14->V1", "value": 0.15151515151515152}, {"source": "L4N35", "target": "dummy->L4N35->L5N13->V1", "value": 0.15151515151515152}, {"source": "L6N0", "target": "L7N2", "value": 14.84848484848485}, {"source": "L6N0", "target": "L7N3", "value": 11.363636363636363}, {"source": "L6N1", "target": "L7N2", "value": 11.06060606060606}, {"source": "L6N2", "target": "L7N2", "value": 5.303030303030303}, {"source": "L6N3", "target": "L7N2", "value": 1.5151515151515151}, {"source": "L6N3", "target": "L7N1", "value": 0.9090909090909092}, {"source": "L6N3", "target": "L7N3", "value": 1.2121212121212122}, {"source": "L6N3", "target": "L7N0", "value": 0.4545454545454546}, {"source": "dummy->L1N1->L2N15->V1", "target": "L2N15", "value": 0.6060606060606061}, {"source": "dummy->L1N1->L2N7->V1", "target": "L2N7", "value": 0.30303030303030304}, {"source": "dummy->L1N1->L2N11->V1", "target": "L2N11", "value": 0.6060606060606061}, {"source": "dummy->L1N1->L2N14->V1", "target": "L2N14", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N0->V1", "target": "L2N0", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N21->V1", "target": "L2N21", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N3->V1", "target": "L2N3", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N8->V1", "target": "L2N8", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N20->V1", "target": "L2N20", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N9->V1", "target": "L2N9", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N2->V1", "target": "L2N2", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N6->V1", "target": "L2N6", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N4->V1", "target": "L2N4", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N16->V1", "target": "L2N16", "value": 0.15151515151515152}, {"source": "dummy->L1N1->L2N13->V1", "target": "L2N13", "value": 0.15151515151515152}, {"source": "dummy->L1N5->L2N16->V1", "target": "L2N16", "value": 0.15151515151515152}, {"source": "dummy->L1N10->L2N11->V1", "target": "L2N11", "value": 0.15151515151515152}, {"source": "dummy->L2N24->L3N6->V1", "target": "dummy->L2N24->L3N6->V2", "value": 0.15151515151515152}, {"source": "dummy->L2N24->L3N6->V2", "target": "L3N6", "value": 0.15151515151515152}, {"source": "dummy->L4N6->L5N20->V1", "target": "dummy->L4N6->L5N20->V2", "value": 0.15151515151515152}, {"source": "dummy->L4N6->L5N20->V2", "target": "dummy->L4N6->L5N20->V3", "value": 0.15151515151515152}, {"source": "dummy->L4N6->L5N20->V3", "target": "dummy->L4N6->L5N20->V4", "value": 0.15151515151515152}, {"source": "dummy->L4N6->L5N20->V4", "target": "L5N20", "value": 0.15151515151515152}, {"source": "dummy->L4N10->L5N11->V1", "target": "dummy->L4N10->L5N11->V2", "value": 0.15151515151515152}, {"source": "dummy->L4N10->L5N11->V2", "target": "dummy->L4N10->L5N11->V3", "value": 0.15151515151515152}, {"source": "dummy->L4N10->L5N11->V3", "target": "dummy->L4N10->L5N11->V4", "value": 0.15151515151515152}, {"source": "dummy->L4N10->L5N11->V4", "target": "L5N11", "value": 0.15151515151515152}, {"source": "dummy->L4N11->L5N18->V1", "target": "dummy->L4N11->L5N18->V2", "value": 0.15151515151515152}, {"source": "dummy->L4N11->L5N18->V2", "target": "dummy->L4N11->L5N18->V3", "value": 0.15151515151515152}, {"source": "dummy->L4N11->L5N18->V3", "target": "dummy->L4N11->L5N18->V4", "value": 0.15151515151515152}, {"source": "dummy->L4N11->L5N18->V4", "target": "L5N18", "value": 0.15151515151515152}, {"source": "dummy->L4N17->L5N14->V1", "target": "dummy->L4N17->L5N14->V2", "value": 0.15151515151515152}, {"source": "dummy->L4N17->L5N14->V2", "target": "dummy->L4N17->L5N14->V3", "value": 0.15151515151515152}, {"source": "dummy->L4N17->L5N14->V3", "target": "dummy->L4N17->L5N14->V4", "value": 0.15151515151515152}, {"source": "dummy->L4N17->L5N14->V4", "target": "L5N14", "value": 0.15151515151515152}, {"source": "dummy->L4N35->L5N13->V1", "target": "dummy->L4N35->L5N13->V2", "value": 0.15151515151515152}, {"source": "dummy->L4N35->L5N13->V2", "target": "dummy->L4N35->L5N13->V3", "value": 0.15151515151515152}, {"source": "dummy->L4N35->L5N13->V3", "target": "dummy->L4N35->L5N13->V4", "value": 0.15151515151515152}, {"source": "dummy->L4N35->L5N13->V4", "target": "L5N13", "value": 0.15151515151515152}, {"source": "dummy->L2N23->L3N9->V2", "target": "L3N9", "value": 0.15151515151515152}, {"source": "dummy->L2N18->L3N6->V2", "target": "L3N6", "value": 0.15151515151515152}, {"source": "dummy->L2N10->L3N0->V2", "target": "L3N0", "value": 0.15151515151515152}, {"source": "dummy->L2N12->L3N11->V2", "target": "L3N11", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N6->V2", "target": "L3N6", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N10->V2", "target": "L3N10", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N1->V2", "target": "L3N1", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N0->V2", "target": "L3N0", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N5->V2", "target": "L3N5", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N11->V2", "target": "L3N11", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N3->V2", "target": "L3N3", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N8->V2", "target": "L3N8", "value": 0.15151515151515152}, {"source": "dummy->L2N5->L3N9->V2", "target": "L3N9", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N6->V2", "target": "L3N6", "value": 25.606060606060606}, {"source": "dummy->L2N1->L3N2->V2", "target": "L3N2", "value": 7.272727272727273}, {"source": "dummy->L2N1->L3N10->V2", "target": "L3N10", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N7->V2", "target": "L3N7", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N1->V2", "target": "L3N1", "value": 0.6060606060606061}, {"source": "dummy->L2N1->L3N4->V2", "target": "L3N4", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N0->V2", "target": "L3N0", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N5->V2", "target": "L3N5", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N11->V2", "target": "L3N11", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N3->V2", "target": "L3N3", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N8->V2", "target": "L3N8", "value": 0.15151515151515152}, {"source": "dummy->L2N1->L3N9->V2", "target": "L3N9", "value": 0.15151515151515152}, {"source": "dummy->L2N22->L3N1->V2", "target": "L3N1", "value": 0.15151515151515152}]

//nodesPositionInfo:
let level = [[{"x": 448.0, "y": 120.0, "name": "L0N0"}, {"x": 448.0, "y": 204.0, "name": "L0N1"}, {"x": 448.0, "y": 218.0, "name": "L0N2"}, {"x": 448.0, "y": 228.66666666666666, "name": "L0N3"}, {"x": 448.0, "y": 235.6969696969697, "name": "L0N4"}, {"x": 448.0, "y": 241.66666666666663, "name": "L0N5"}, {"x": 448.0, "y": 245.96969696969694, "name": "L0N6"}, {"x": 448.0, "y": 250.7272727272727, "name": "L0N7"}, {"x": 448.0, "y": 255.48484848484844, "name": "L0N8"}, {"x": 448.0, "y": 260.2424242424242, "name": "L0N9"}, {"x": 448.0, "y": 264.99999999999994, "name": "L0N10"}, {"x": 448.0, "y": 269.7575757575757, "name": "L0N11"}, {"x": 448.0, "y": 274.51515151515144, "name": "L0N12"}, {"x": 448.0, "y": 279.2727272727272, "name": "L0N13"}, {"x": 448.0, "y": 284.03030303030295, "name": "L0N14"}, {"x": 448.0, "y": 288.7878787878787, "name": "L0N15"}, {"x": 448.0, "y": 293.54545454545445, "name": "L0N16"}, {"x": 448.0, "y": 298.3030303030302, "name": "L0N17"}, {"x": 448.0, "y": 303.06060606060595, "name": "L0N18"}, {"x": 448.0, "y": 307.8181818181817, "name": "L0N19"}, {"x": 448.0, "y": 312.57575757575745, "name": "L0N20"}, {"x": 448.0, "y": 317.3333333333332, "name": "L1N1"}, {"x": 448.0, "y": 343.3030303030302, "name": "L1N5"}, {"x": 448.0, "y": 348.06060606060595, "name": "L1N10"}, {"x": 448.0, "y": 352.8181818181817, "name": "L1N15"}, {"x": 448.0, "y": 357.57575757575745, "name": "L2N24"}, {"x": 448.0, "y": 362.3333333333332, "name": "L4N6"}, {"x": 448.0, "y": 367.09090909090895, "name": "L4N10"}, {"x": 448.0, "y": 371.8484848484847, "name": "L4N11"}, {"x": 448.0, "y": 376.60606060606045, "name": "L4N17"}, {"x": 448.0, "y": 381.3636363636362, "name": "L4N35"}], [{"x": 823.1194933739623, "y": 0.45454545454545453, "name": "L1N9"}, {"x": 823.1194933739623, "y": 3.2121212121212124, "name": "L1N20"}, {"x": 823.1194933739623, "y": 5.969696969696971, "name": "L1N27"}, {"x": 823.1194933739623, "y": 8.727272727272728, "name": "L1N4"}, {"x": 823.1194933739623, "y": 11.484848484848486, "name": "L1N24"}, {"x": 823.1194933739623, "y": 14.242424242424244, "name": "L1N25"}, {"x": 823.1194933739623, "y": 17.0, "name": "L1N22"}, {"x": 823.1194933739623, "y": 19.757575757575758, "name": "L1N16"}, {"x": 823.1194933739623, "y": 22.515151515151516, "name": "L1N26"}, {"x": 823.1194933739623, "y": 25.272727272727273, "name": "L1N23"}, {"x": 823.1194933739623, "y": 28.484848484848488, "name": "L1N2"}, {"x": 823.1194933739623, "y": 31.545454545454547, "name": "L1N19"}, {"x": 823.1194933739623, "y": 34.3030303030303, "name": "L1N3"}, {"x": 823.1194933739623, "y": 37.060606060606055, "name": "L1N7"}, {"x": 823.1194933739623, "y": 39.81818181818181, "name": "L1N11"}, {"x": 823.1194933739623, "y": 42.57575757575757, "name": "L1N14"}, {"x": 823.1194933739623, "y": 45.33333333333333, "name": "L1N17"}, {"x": 823.1194933739623, "y": 48.090909090909086, "name": "L1N13"}, {"x": 823.1194933739623, "y": 50.848484848484844, "name": "L1N18"}, {"x": 823.1194933739623, "y": 53.6060606060606, "name": "L1N8"}, {"x": 823.1194933739623, "y": 56.36363636363636, "name": "L1N12"}, {"x": 823.1194933739623, "y": 173.2121212121212, "name": "L1N0"}, {"x": 823.1194933739623, "y": 251.57575757575756, "name": "L1N6"}, {"x": 823.1194933739623, "y": 254.33333333333331, "name": "L1N21"}, {"x": 823.1194933739623, "y": 257.09090909090907, "name": "dummy->L1N1->L2N7->V1"}, {"x": 823.1194933739623, "y": 261.060606060606, "name": "dummy->L1N1->L2N8->V1"}, {"x": 823.1194933739623, "y": 263.81818181818176, "name": "dummy->L1N1->L2N16->V1"}, {"x": 823.1194933739623, "y": 266.5757575757575, "name": "dummy->L1N1->L2N14->V1"}, {"x": 823.1194933739623, "y": 268.8787878787878, "name": "dummy->L1N1->L2N11->V1"}, {"x": 823.1194933739623, "y": 274.36363636363626, "name": "dummy->L1N1->L2N21->V1"}, {"x": 823.1194933739623, "y": 276.6666666666666, "name": "L2N5"}, {"x": 823.1194933739623, "y": 285.4848484848484, "name": "dummy->L1N1->L2N2->V1"}, {"x": 823.1194933739623, "y": 288.24242424242414, "name": "L2N10"}, {"x": 823.1194933739623, "y": 291.4545454545453, "name": "dummy->L1N1->L2N9->V1"}, {"x": 823.1194933739623, "y": 293.75757575757564, "name": "dummy->L1N1->L2N15->V1"}, {"x": 823.1194933739623, "y": 298.78787878787864, "name": "dummy->L1N1->L2N20->V1"}, {"x": 823.1194933739623, "y": 301.5454545454544, "name": "L2N12"}, {"x": 823.1194933739623, "y": 304.30303030303014, "name": "dummy->L1N1->L2N0->V1"}, {"x": 823.1194933739623, "y": 307.51515151515133, "name": "dummy->L1N1->L2N13->V1"}, {"x": 823.1194933739623, "y": 310.2727272727271, "name": "dummy->L1N1->L2N6->V1"}, {"x": 823.1194933739623, "y": 312.5757575757574, "name": "L2N1"}, {"x": 823.1194933739623, "y": 488.81818181818164, "name": "dummy->L1N1->L2N4->V1"}, {"x": 823.1194933739623, "y": 491.5757575757574, "name": "dummy->L1N1->L2N3->V1"}, {"x": 823.1194933739623, "y": 494.33333333333314, "name": "L2N18"}, {"x": 823.1194933739623, "y": 497.0909090909089, "name": "L2N22"}, {"x": 823.1194933739623, "y": 499.84848484848465, "name": "dummy->L1N5->L2N16->V1"}, {"x": 823.1194933739623, "y": 502.6060606060604, "name": "L2N23"}, {"x": 823.1194933739623, "y": 505.36363636363615, "name": "dummy->L1N10->L2N11->V1"}, {"x": 823.1194933739623, "y": 508.1212121212119, "name": "dummy->L2N24->L3N6->V1"}, {"x": 823.1194933739623, "y": 510.87878787878765, "name": "dummy->L4N6->L5N20->V1"}, {"x": 823.1194933739623, "y": 513.6363636363634, "name": "dummy->L4N10->L5N11->V1"}, {"x": 823.1194933739623, "y": 516.3939393939391, "name": "dummy->L4N11->L5N18->V1"}, {"x": 823.1194933739623, "y": 519.1515151515149, "name": "dummy->L4N17->L5N14->V1"}, {"x": 823.1194933739623, "y": 521.9090909090907, "name": "dummy->L4N35->L5N13->V1"}], [{"x": 1234.3776738626082, "y": 0.45454545454545453, "name": "L2N14"}, {"x": 1234.3776738626082, "y": 4.212121212121213, "name": "L2N17"}, {"x": 1234.3776738626082, "y": 7.969696969696971, "name": "L2N21"}, {"x": 1234.3776738626082, "y": 11.727272727272728, "name": "L2N19"}, {"x": 1234.3776738626082, "y": 15.939393939393941, "name": "L2N7"}, {"x": 1234.3776738626082, "y": 20.0, "name": "L2N9"}, {"x": 1234.3776738626082, "y": 23.757575757575758, "name": "L2N8"}, {"x": 1234.3776738626082, "y": 30.242424242424246, "name": "L2N4"}, {"x": 1234.3776738626082, "y": 35.81818181818181, "name": "L2N6"}, {"x": 1234.3776738626082, "y": 47.75757575757576, "name": "L2N0"}, {"x": 1234.3776738626082, "y": 56.96969696969696, "name": "L2N16"}, {"x": 1234.3776738626082, "y": 60.72727272727272, "name": "L2N13"}, {"x": 1234.3776738626082, "y": 71.75757575757575, "name": "L2N2"}, {"x": 1234.3776738626082, "y": 80.36363636363636, "name": "L2N15"}, {"x": 1234.3776738626082, "y": 84.12121212121211, "name": "L2N20"}, {"x": 1234.3776738626082, "y": 87.87878787878786, "name": "dummy->L2N5->L3N6->V2"}, {"x": 1234.3776738626082, "y": 91.63636363636361, "name": "dummy->L2N5->L3N8->V2"}, {"x": 1234.3776738626082, "y": 95.39393939393936, "name": "dummy->L2N5->L3N5->V2"}, {"x": 1234.3776738626082, "y": 99.15151515151511, "name": "dummy->L2N5->L3N0->V2"}, {"x": 1234.3776738626082, "y": 102.90909090909086, "name": "dummy->L2N5->L3N11->V2"}, {"x": 1234.3776738626082, "y": 106.66666666666661, "name": "dummy->L2N5->L3N9->V2"}, {"x": 1234.3776738626082, "y": 110.42424242424237, "name": "dummy->L2N5->L3N10->V2"}, {"x": 1234.3776738626082, "y": 114.18181818181812, "name": "dummy->L2N5->L3N3->V2"}, {"x": 1234.3776738626082, "y": 117.93939393939387, "name": "dummy->L2N5->L3N1->V2"}, {"x": 1234.3776738626082, "y": 123.96969696969688, "name": "L2N3"}, {"x": 1234.3776738626082, "y": 129.24242424242414, "name": "dummy->L2N10->L3N0->V2"}, {"x": 1234.3776738626082, "y": 132.9999999999999, "name": "L2N11"}, {"x": 1234.3776738626082, "y": 136.75757575757564, "name": "dummy->L2N12->L3N11->V2"}, {"x": 1234.3776738626082, "y": 140.5151515151514, "name": "dummy->L2N1->L3N10->V2"}, {"x": 1234.3776738626082, "y": 144.27272727272714, "name": "dummy->L2N1->L3N4->V2"}, {"x": 1234.3776738626082, "y": 188.11846069394068, "name": "dummy->L2N1->L3N6->V2"}, {"x": 1234.3776738626082, "y": 278.6060606060605, "name": "dummy->L2N1->L3N11->V2"}, {"x": 1234.3776738626082, "y": 282.36363636363626, "name": "dummy->L2N1->L3N7->V2"}, {"x": 1234.3776738626082, "y": 286.121212121212, "name": "dummy->L2N1->L3N1->V2"}, {"x": 1234.3776738626082, "y": 292.151515151515, "name": "dummy->L2N1->L3N2->V2"}, {"x": 1234.3776738626082, "y": 331.5151515151514, "name": "dummy->L2N1->L3N9->V2"}, {"x": 1234.3776738626082, "y": 335.27272727272714, "name": "dummy->L2N1->L3N0->V2"}, {"x": 1234.3776738626082, "y": 339.0303030303029, "name": "dummy->L2N1->L3N5->V2"}, {"x": 1234.3776738626082, "y": 342.78787878787864, "name": "dummy->L2N1->L3N3->V2"}, {"x": 1234.3776738626082, "y": 346.5454545454544, "name": "dummy->L2N1->L3N8->V2"}, {"x": 1234.3776738626082, "y": 350.30303030303014, "name": "dummy->L2N18->L3N6->V2"}, {"x": 1234.3776738626082, "y": 354.0606060606059, "name": "dummy->L2N22->L3N1->V2"}, {"x": 1234.3776738626082, "y": 357.81818181818164, "name": "dummy->L2N23->L3N9->V2"}, {"x": 1234.3776738626082, "y": 361.5757575757574, "name": "dummy->L2N24->L3N6->V2"}, {"x": 1234.3776738626082, "y": 365.33333333333314, "name": "dummy->L4N6->L5N20->V2"}, {"x": 1234.3776738626082, "y": 369.0909090909089, "name": "dummy->L4N10->L5N11->V2"}, {"x": 1234.3776738626082, "y": 372.84848484848465, "name": "dummy->L4N11->L5N18->V2"}, {"x": 1234.3776738626082, "y": 376.6060606060604, "name": "dummy->L4N17->L5N14->V2"}, {"x": 1234.3776738626082, "y": 380.36363636363615, "name": "dummy->L4N35->L5N13->V2"}], [{"x": 1672.9020127899612, "y": 1.8181818181818181, "name": "L3N4"}, {"x": 1672.9020127899612, "y": 11.939393939393941, "name": "L3N5"}, {"x": 1672.9020127899612, "y": 21.0, "name": "L3N10"}, {"x": 1672.9020127899612, "y": 33.39393939393939, "name": "L3N3"}, {"x": 1672.9020127899612, "y": 44.57575757575757, "name": "L3N9"}, {"x": 1672.9020127899612, "y": 53.78787878787879, "name": "L3N7"}, {"x": 1672.9020127899612, "y": 62.848484848484844, "name": "L3N11"}, {"x": 1672.9020127899612, "y": 181.60606060606062, "name": "L3N0"}, {"x": 1672.9020127899612, "y": 263.24242424242425, "name": "L3N8"}, {"x": 1672.9020127899612, "y": 272.27172350233866, "name": "L3N6"}, {"x": 1672.9020127899612, "y": 281.5151515151515, "name": "L3N1"}, {"x": 1672.9020127899612, "y": 317.5454545454545, "name": "L3N2"}, {"x": 1672.9020127899612, "y": 329.3333333333333, "name": "dummy->L4N6->L5N20->V3"}, {"x": 1672.9020127899612, "y": 338.09090909090907, "name": "dummy->L4N10->L5N11->V3"}, {"x": 1672.9020127899612, "y": 346.8484848484848, "name": "dummy->L4N11->L5N18->V3"}, {"x": 1672.9020127899612, "y": 355.60606060606057, "name": "dummy->L4N17->L5N14->V3"}, {"x": 1672.9020127899612, "y": 364.3636363636363, "name": "dummy->L4N35->L5N13->V3"}], [{"x": 2125.491081981666, "y": 0.45454545454545453, "name": "L4N30"}, {"x": 2125.491081981666, "y": 4.212121212121213, "name": "L4N21"}, {"x": 2125.491081981666, "y": 13.424242424242424, "name": "L4N0"}, {"x": 2125.491081981666, "y": 20.76090616304979, "name": "L4N14"}, {"x": 2125.491081981666, "y": 24.575757575757574, "name": "L4N19"}, {"x": 2125.491081981666, "y": 28.333333333333332, "name": "L4N22"}, {"x": 2125.491081981666, "y": 32.090909090909086, "name": "L4N16"}, {"x": 2125.491081981666, "y": 35.84848484848484, "name": "L4N23"}, {"x": 2125.491081981666, "y": 39.606060606060595, "name": "L4N33"}, {"x": 2125.491081981666, "y": 43.36363636363635, "name": "L4N7"}, {"x": 2125.491081981666, "y": 47.12121212121211, "name": "L4N37"}, {"x": 2125.491081981666, "y": 50.87878787878787, "name": "L4N9"}, {"x": 2125.491081981666, "y": 54.636363636363626, "name": "L4N12"}, {"x": 2125.491081981666, "y": 58.393939393939384, "name": "L4N15"}, {"x": 2125.491081981666, "y": 62.15151515151514, "name": "L4N5"}, {"x": 2125.491081981666, "y": 65.9090909090909, "name": "L4N36"}, {"x": 2125.491081981666, "y": 69.66666666666667, "name": "L4N28"}, {"x": 2125.491081981666, "y": 73.42424242424242, "name": "L4N18"}, {"x": 2125.491081981666, "y": 77.18181818181817, "name": "L4N32"}, {"x": 2125.491081981666, "y": 80.93939393939392, "name": "L4N3"}, {"x": 2125.491081981666, "y": 84.69696969696967, "name": "L4N24"}, {"x": 2125.491081981666, "y": 88.45454545454542, "name": "L4N29"}, {"x": 2125.491081981666, "y": 92.21212121212118, "name": "L4N26"}, {"x": 2125.491081981666, "y": 104.60606060606057, "name": "L4N1"}, {"x": 2125.491081981666, "y": 113.66666666666663, "name": "L4N25"}, {"x": 2125.491081981666, "y": 117.42424242424238, "name": "L4N31"}, {"x": 2125.491081981666, "y": 121.18181818181813, "name": "L4N13"}, {"x": 2125.491081981666, "y": 124.93939393939388, "name": "L4N34"}, {"x": 2125.491081981666, "y": 128.69696969696963, "name": "L4N27"}, {"x": 2125.491081981666, "y": 133.3636363636363, "name": "L4N4"}, {"x": 2125.491081981666, "y": 147.59565644134716, "name": "L4N2"}, {"x": 2125.491081981666, "y": 321.03030303030295, "name": "L4N20"}, {"x": 2125.491081981666, "y": 324.7878787878787, "name": "L4N8"}, {"x": 2125.491081981666, "y": 328.54545454545445, "name": "dummy->L4N6->L5N20->V4"}, {"x": 2125.491081981666, "y": 332.3030303030302, "name": "dummy->L4N10->L5N11->V4"}, {"x": 2125.491081981666, "y": 336.06060606060595, "name": "dummy->L4N11->L5N18->V4"}, {"x": 2125.491081981666, "y": 339.8181818181817, "name": "dummy->L4N17->L5N14->V4"}, {"x": 2125.491081981666, "y": 343.57575757575745, "name": "dummy->L4N35->L5N13->V4"}], [{"x": 2641.6459831971006, "y": 4.545454545454546, "name": "L5N6"}, {"x": 2641.6459831971006, "y": 26.84848484848485, "name": "L5N3"}, {"x": 2641.6459831971006, "y": 49.303030303030305, "name": "L5N4"}, {"x": 2641.6459831971006, "y": 61.151515151515156, "name": "L5N14"}, {"x": 2641.6459831971006, "y": 69.36363636363636, "name": "L5N20"}, {"x": 2641.6459831971006, "y": 76.66666666666666, "name": "L5N1"}, {"x": 2641.6459831971006, "y": 121.54545454545453, "name": "L5N12"}, {"x": 2641.6459831971006, "y": 129.30303030303028, "name": "L5N9"}, {"x": 2641.6459831971006, "y": 137.06060606060603, "name": "L5N17"}, {"x": 2641.6459831971006, "y": 144.81818181818178, "name": "L5N15"}, {"x": 2641.6459831971006, "y": 152.57575757575754, "name": "L5N11"}, {"x": 2641.6459831971006, "y": 160.3333333333333, "name": "L5N7"}, {"x": 2641.6459831971006, "y": 168.09090909090904, "name": "L5N16"}, {"x": 2641.6459831971006, "y": 176.30303030303023, "name": "L5N10"}, {"x": 2641.6459831971006, "y": 208.15151515151507, "name": "L5N0"}, {"x": 2641.6459831971006, "y": 231.51515151515144, "name": "L5N5"}, {"x": 2641.6459831971006, "y": 239.2727272727272, "name": "L5N13"}, {"x": 2641.6459831971006, "y": 247.03030303030295, "name": "L5N8"}, {"x": 2641.6459831971006, "y": 254.7878787878787, "name": "L5N2"}, {"x": 2641.6459831971006, "y": 364.81818181818176, "name": "L5N18"}, {"x": 2641.6459831971006, "y": 372.5757575757575, "name": "L5N19"}], [{"x": 2963.6613716697975, "y": 0, "name": "L6N3"}, {"x": 2963.6613716697975, "y": 73.36363636363636, "name": "L6N2"}, {"x": 2963.6613716697975, "y": 154.15151515151516, "name": "L6N1"}, {"x": 2963.6613716697975, "y": 222.99261146273335, "name": "L6N0"}], [{"x": 3136.0, "y": 0, "name": "L7N1"}, {"x": 3136.0, "y": 42.90909090909091, "name": "L7N0"}, {"x": 3136.0, "y": 80.81818181818181, "name": "L7N2"}, {"x": 3136.0, "y": 281.45454545454544, "name": "L7N3"}]]

let result = [[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54], [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49], [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38], [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21], [1, 2, 3, 4], [1, 2, 3, 4]]

//original_level
//let level_html = [[{"name": "L0N0", "size": 40.0}, {"name": "L0N1", "size": 1.3636363636363638}, {"name": "L0N2", "size": 1.0606060606060606}, {"name": "L0N3", "size": 1.5151515151515151}, {"name": "L0N4", "size": 0.30303030303030304}, {"name": "L0N5", "size": 0.15151515151515152}, {"name": "L0N6", "size": 0.15151515151515152}, {"name": "L0N7", "size": 0.15151515151515152}, {"name": "L0N8", "size": 0.15151515151515152}, {"name": "L0N9", "size": 0.15151515151515152}, {"name": "L0N10", "size": 0.15151515151515152}, {"name": "L0N11", "size": 0.15151515151515152}, {"name": "L0N12", "size": 0.15151515151515152}, {"name": "L0N13", "size": 0.15151515151515152}, {"name": "L0N14", "size": 0.15151515151515152}, {"name": "L0N15", "size": 0.15151515151515152}, {"name": "L0N16", "size": 0.15151515151515152}, {"name": "L0N17", "size": 0.15151515151515152}, {"name": "L0N18", "size": 0.15151515151515152}, {"name": "L0N19", "size": 0.15151515151515152}, {"name": "L0N20", "size": 0.15151515151515152}, {"name": "L1N1", "size": 4.3939393939393945}, {"name": "L1N5", "size": 0.15151515151515152}, {"name": "L1N10", "size": 0.15151515151515152}, {"name": "L1N15", "size": 0.15151515151515152}, {"name": "L2N24", "size": 0.15151515151515152}, {"name": "L4N6", "size": 0.15151515151515152}, {"name": "L4N10", "size": 0.15151515151515152}, {"name": "L4N11", "size": 0.15151515151515152}, {"name": "L4N17", "size": 0.15151515151515152}, {"name": "L4N35", "size": 0.15151515151515152}], [{"name": "L1N9", "size": 0.15151515151515152}, {"name": "L1N20", "size": 0.15151515151515152}, {"name": "L1N27", "size": 0.15151515151515152}, {"name": "L1N4", "size": 0.15151515151515152}, {"name": "L1N24", "size": 0.15151515151515152}, {"name": "L1N25", "size": 0.15151515151515152}, {"name": "L1N22", "size": 0.15151515151515152}, {"name": "L1N16", "size": 0.15151515151515152}, {"name": "L1N26", "size": 0.15151515151515152}, {"name": "L1N23", "size": 0.15151515151515152}, {"name": "L1N2", "size": 0.30303030303030304}, {"name": "L1N19", "size": 0.15151515151515152}, {"name": "L1N3", "size": 0.15151515151515152}, {"name": "L1N7", "size": 0.15151515151515152}, {"name": "L1N11", "size": 0.15151515151515152}, {"name": "L1N14", "size": 0.15151515151515152}, {"name": "L1N17", "size": 0.15151515151515152}, {"name": "L1N13", "size": 0.15151515151515152}, {"name": "L1N18", "size": 0.15151515151515152}, {"name": "L1N8", "size": 0.15151515151515152}, {"name": "L1N12", "size": 0.15151515151515152}, {"name": "L1N0", "size": 38.18181818181818}, {"name": "L1N6", "size": 0.15151515151515152}, {"name": "L1N21", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N7->V1", "size": 0.30303030303030304}, {"name": "dummy->L1N1->L2N8->V1", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N16->V1", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N14->V1", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N11->V1", "size": 0.6060606060606061}, {"name": "dummy->L1N1->L2N21->V1", "size": 0.15151515151515152}, {"name": "L2N5", "size": 1.3636363636363638}, {"name": "dummy->L1N1->L2N2->V1", "size": 0.15151515151515152}, {"name": "L2N10", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N9->V1", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N15->V1", "size": 0.6060606060606061}, {"name": "dummy->L1N1->L2N20->V1", "size": 0.15151515151515152}, {"name": "L2N12", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N0->V1", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N13->V1", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N6->V1", "size": 0.15151515151515152}, {"name": "L2N1", "size": 34.84848484848485}, {"name": "dummy->L1N1->L2N4->V1", "size": 0.15151515151515152}, {"name": "dummy->L1N1->L2N3->V1", "size": 0.15151515151515152}, {"name": "L2N18", "size": 0.15151515151515152}, {"name": "L2N22", "size": 0.15151515151515152}, {"name": "dummy->L1N5->L2N16->V1", "size": 0.15151515151515152}, {"name": "L2N23", "size": 0.15151515151515152}, {"name": "dummy->L1N10->L2N11->V1", "size": 0.15151515151515152}, {"name": "dummy->L2N24->L3N6->V1", "size": 0.15151515151515152}, {"name": "dummy->L4N6->L5N20->V1", "size": 0.15151515151515152}, {"name": "dummy->L4N10->L5N11->V1", "size": 0.15151515151515152}, {"name": "dummy->L4N11->L5N18->V1", "size": 0.15151515151515152}, {"name": "dummy->L4N17->L5N14->V1", "size": 0.15151515151515152}, {"name": "dummy->L4N35->L5N13->V1", "size": 0.15151515151515152}], [{"name": "L2N14", "size": 0.15151515151515152}, {"name": "L2N17", "size": 0.15151515151515152}, {"name": "L2N21", "size": 0.15151515151515152}, {"name": "L2N19", "size": 0.15151515151515152}, {"name": "L2N7", "size": 0.30303030303030304}, {"name": "L2N9", "size": 0.15151515151515152}, {"name": "L2N8", "size": 0.15151515151515152}, {"name": "L2N4", "size": 1.0606060606060606}, {"name": "L2N6", "size": 0.15151515151515152}, {"name": "L2N0", "size": 2.878787878787879}, {"name": "L2N16", "size": 0.15151515151515152}, {"name": "L2N13", "size": 0.15151515151515152}, {"name": "L2N2", "size": 2.5757575757575757}, {"name": "L2N15", "size": 0.15151515151515152}, {"name": "L2N20", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N6->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N8->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N5->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N0->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N11->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N9->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N10->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N3->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N5->L3N1->V2", "size": 0.15151515151515152}, {"name": "L2N3", "size": 0.9090909090909092}, {"name": "dummy->L2N10->L3N0->V2", "size": 0.15151515151515152}, {"name": "L2N11", "size": 0.15151515151515152}, {"name": "dummy->L2N12->L3N11->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N10->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N4->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N6->V2", "size": 25.606060606060606}, {"name": "dummy->L2N1->L3N11->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N7->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N1->V2", "size": 0.6060606060606061}, {"name": "dummy->L2N1->L3N2->V2", "size": 7.272727272727273}, {"name": "dummy->L2N1->L3N9->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N0->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N5->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N3->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N1->L3N8->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N18->L3N6->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N22->L3N1->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N23->L3N9->V2", "size": 0.15151515151515152}, {"name": "dummy->L2N24->L3N6->V2", "size": 0.15151515151515152}, {"name": "dummy->L4N6->L5N20->V2", "size": 0.15151515151515152}, {"name": "dummy->L4N10->L5N11->V2", "size": 0.15151515151515152}, {"name": "dummy->L4N11->L5N18->V2", "size": 0.15151515151515152}, {"name": "dummy->L4N17->L5N14->V2", "size": 0.15151515151515152}, {"name": "dummy->L4N35->L5N13->V2", "size": 0.15151515151515152}], [{"name": "L3N4", "size": 0.6060606060606061}, {"name": "L3N5", "size": 0.30303030303030304}, {"name": "L3N10", "size": 0.15151515151515152}, {"name": "L3N3", "size": 1.3636363636363638}, {"name": "L3N9", "size": 0.15151515151515152}, {"name": "L3N7", "size": 0.30303030303030304}, {"name": "L3N11", "size": 0.15151515151515152}, {"name": "L3N0", "size": 36.81818181818182}, {"name": "L3N8", "size": 0.15151515151515152}, {"name": "L3N6", "size": 0.30303030303030304}, {"name": "L3N1", "size": 5.606060606060606}, {"name": "L3N2", "size": 0.7575757575757576}, {"name": "dummy->L4N6->L5N20->V3", "size": 0.15151515151515152}, {"name": "dummy->L4N10->L5N11->V3", "size": 0.15151515151515152}, {"name": "dummy->L4N11->L5N18->V3", "size": 0.15151515151515152}, {"name": "dummy->L4N17->L5N14->V3", "size": 0.15151515151515152}, {"name": "dummy->L4N35->L5N13->V3", "size": 0.15151515151515152}], [{"name": "L4N30", "size": 0.15151515151515152}, {"name": "L4N21", "size": 0.15151515151515152}, {"name": "L4N0", "size": 1.9696969696969697}, {"name": "L4N14", "size": 0.15151515151515152}, {"name": "L4N19", "size": 0.15151515151515152}, {"name": "L4N22", "size": 0.15151515151515152}, {"name": "L4N16", "size": 0.15151515151515152}, {"name": "L4N23", "size": 0.15151515151515152}, {"name": "L4N33", "size": 0.15151515151515152}, {"name": "L4N7", "size": 0.15151515151515152}, {"name": "L4N37", "size": 0.15151515151515152}, {"name": "L4N9", "size": 0.15151515151515152}, {"name": "L4N12", "size": 0.15151515151515152}, {"name": "L4N15", "size": 0.15151515151515152}, {"name": "L4N5", "size": 0.15151515151515152}, {"name": "L4N36", "size": 0.15151515151515152}, {"name": "L4N28", "size": 0.15151515151515152}, {"name": "L4N18", "size": 0.15151515151515152}, {"name": "L4N32", "size": 0.15151515151515152}, {"name": "L4N3", "size": 0.15151515151515152}, {"name": "L4N24", "size": 0.15151515151515152}, {"name": "L4N29", "size": 0.15151515151515152}, {"name": "L4N26", "size": 0.15151515151515152}, {"name": "L4N1", "size": 3.0303030303030303}, {"name": "L4N25", "size": 0.15151515151515152}, {"name": "L4N31", "size": 0.15151515151515152}, {"name": "L4N13", "size": 0.15151515151515152}, {"name": "L4N34", "size": 0.15151515151515152}, {"name": "L4N27", "size": 0.15151515151515152}, {"name": "L4N4", "size": 0.30303030303030304}, {"name": "L4N2", "size": 36.21212121212121}, {"name": "L4N20", "size": 0.15151515151515152}, {"name": "L4N8", "size": 0.15151515151515152}, {"name": "dummy->L4N6->L5N20->V4", "size": 0.15151515151515152}, {"name": "dummy->L4N10->L5N11->V4", "size": 0.15151515151515152}, {"name": "dummy->L4N11->L5N18->V4", "size": 0.15151515151515152}, {"name": "dummy->L4N17->L5N14->V4", "size": 0.15151515151515152}, {"name": "dummy->L4N35->L5N13->V4", "size": 0.15151515151515152}], [{"name": "L5N6", "size": 1.5151515151515151}, {"name": "L5N3", "size": 4.090909090909091}, {"name": "L5N4", "size": 2.4242424242424243}, {"name": "L5N14", "size": 0.15151515151515152}, {"name": "L5N20", "size": 0.15151515151515152}, {"name": "L5N1", "size": 7.575757575757576}, {"name": "L5N12", "size": 0.15151515151515152}, {"name": "L5N9", "size": 0.15151515151515152}, {"name": "L5N17", "size": 0.15151515151515152}, {"name": "L5N15", "size": 0.15151515151515152}, {"name": "L5N11", "size": 0.15151515151515152}, {"name": "L5N7", "size": 0.15151515151515152}, {"name": "L5N16", "size": 0.15151515151515152}, {"name": "L5N10", "size": 0.15151515151515152}, {"name": "L5N0", "size": 8.181818181818182}, {"name": "L5N5", "size": 0.15151515151515152}, {"name": "L5N13", "size": 0.15151515151515152}, {"name": "L5N8", "size": 0.15151515151515152}, {"name": "L5N2", "size": 20.606060606060606}, {"name": "L5N18", "size": 0.15151515151515152}, {"name": "L5N19", "size": 0.15151515151515152}], [{"name": "L6N3", "size": 4.090909090909091}, {"name": "L6N2", "size": 5.303030303030303}, {"name": "L6N1", "size": 11.06060606060606}, {"name": "L6N0", "size": 26.212121212121215}], [{"name": "L7N1", "size": 0.9090909090909092}, {"name": "L7N0", "size": 0.4545454545454546}, {"name": "L7N2", "size": 32.72727272727273}, {"name": "L7N3", "size": 12.575757575757576}]]


        let nodes = []
        result.forEach((d, i) => {
            d.forEach(j => {
                nodes.push(level[i][parseInt(j) - 1])
            })
        })
        console.log(nodes)

        var another = nodes.map(d => ({name: d['name']}))
        var orgNode = nodes.map(d => d.name)
        var anotherLinks = links.map(d => ({
                'source': orgNode.indexOf(d.source),
                'target': orgNode.indexOf(d.target),
                'value': d.value
            }
        ))
        console.log(nodes, links)
        var data = ({
            "nodes": nodes,
            "links": links,
        })

        var nodeMap = {};
        var graph = data;
        graph.nodes.forEach(function (x) {
            nodeMap[x.name] = x;
        });
        console.log(nodeMap)
        graph.links = graph.links.map(function (x) {
            if (typeof nodeMap[x.target] === "undefined") console.log(x.target)
            if (typeof nodeMap[x.source] === "undefined") console.log(x.source)
            return {
                source: nodeMap[x.source],
                target: nodeMap[x.target],
                value: x.value
            };
        });
        console.log(graph)

        sankey
            .nodes(graph.nodes)
            .links(graph.links)
            .layout(32);
        // add in the nodes
        var node = svg.append("g").selectAll(".node")
            .data(graph.nodes)
            .enter().append("g")
            .attr("class", "node")
            .attr("transform", function (d) {
                return "translate(" + d.x + "," + d.y + ")";
            })

        // add the rectangles for the nodes
        node.append("rect")
            .attr("name", (d) => d.name)
            .attr("height", function (d) {
                return d.dy;
            })
            .attr("width", sankey.nodeWidth())
            .style("fill", function (d) {
                return d.color = color(d.name.replace(/ .*/, ""));
            })
            .style("stroke", function (d) {
                return d3.rgb(d.color).darker(1);
            })
            .append("title")
            .text(function (d) {
                return d.name + "\n" + format(d.value);
            });

        // add in the title for the nodes
        node.append("text")
            .attr("x", d => {
                if (d.x < 300)
                    return 6 + sankey.nodeWidth()
                else if (d.x < 1000)
                    return 6 + sankey.nodeWidth()
                else return -6
            })
            .attr("y", function (d) {
                console.log(d);
                return d.dy / 2// + 3;
            })
            .attr("dy", ".35em")
            .attr("text-anchor", d => {
                if (d.x < 200)
                    return "start"
                else if (d.x < 500)
                    return "start"
                else if (d.x < 1000)
                    return "start"
                else return "end"
            })
            .attr("transform", null)
            .text(function (d) {
                return d.name;
            }).style("opacity", 0.8)

        // add in the links
        var link = svg
            .append("g")
            .selectAll(".link")
            .data(graph.links)
            .enter()
            .append("path")
            .attr("class", "link")
            .attr("d", path)
            .attr("name", (d) => d.source.name + "-" + d.target.name)
            .style("stroke-width", function (d) {
                return Math.max(1, d.dy);
            })
            .style("stroke", function (d, i) {
                return d3.rgb(color(i + 5)).darker(0.9)
            })
            // .sort(function (a, b) {return b.dy - a.dy;});
            .append("title")
            .text(function (d) {
                return d.source.name + " → " +
                    d.target.name + "\n" + format(d.value);
            });


        // 线捆绑函数：
        /* 两个实验参数：
        * 1. 表达式的两个参量：alpha, beta
        * 2. “最小基线长度“：minimalBaseLineWidth。如果没有基线则不会进行线捆绑
        * */
        function bundlingMethod(data) {
            console.log(data)

            // at this cycle, we just do the pushing operation
            // after this, we take the baseLine one by one


            for (let i = 0; i < level.length - 1; i++) {

                // Step1. choose which direction will be bundled
                // in this part, we will use the list "level" to judge the bundling direction
                let bundlingFromSource = true
                level[i].length < level[i + 1].length
                    ? bundlingFromSource = true
                    : bundlingFromSource = false

                // we have {level.length} layers and {level.length-1} gaps
                // every gap use same direction to bundle

                if (bundlingFromSource) {
                    // bundling From Source
                    let startNodeIndex = 0
                    let endNodeIndex = 0
                    level.forEach(element => {
                            if (level.indexOf(element) < i) startNodeIndex += element.length
                            if (level.indexOf(element) <= i) endNodeIndex += element.length
                        }
                    )

                    for (let pointerOfLevel = startNodeIndex; pointerOfLevel < endNodeIndex; pointerOfLevel++) {

                        // Step2.
                        // prepare for redrawing the path
                        // cycling in the sourceLinks list of current node to find the baseLine
                        let nodeList = [];
                        for (let t = 0; t < data.nodes[pointerOfLevel].sourceLinks.length; t++)
                            // check all the info on this node at once
                            // we will make slice about it later
                            nodeList.push({
                                linkName: data.nodes[pointerOfLevel].sourceLinks[t].source.name + '-' + data.nodes[pointerOfLevel].sourceLinks[t].target.name,
                                source: {
                                    name: data.nodes[pointerOfLevel].sourceLinks[t].source.name,
                                    x: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].source.x * 1000) / 1000, // node left line position
                                    y: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].source.y * 1000) / 1000, // node top line position
                                    dx: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].source.dx * 1000) / 1000, // node width
                                    dy: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].source.dy * 1000) / 1000, // node height
                                },
                                target: {
                                    name: data.nodes[pointerOfLevel].sourceLinks[t].target.name,
                                    x: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].target.x * 1000) / 1000, // node left line position
                                    y: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].target.y * 1000) / 1000, // node top line position
                                    dx: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].target.dx * 1000) / 1000, // node width
                                    dy: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].target.dy * 1000) / 1000, // node height
                                },
                                dy: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].dy * 1000) / 1000, // stoke-width
                                sy: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].sy * 1000) / 1000, // distance to sourceNode's top line
                                ty: Math.floor(data.nodes[pointerOfLevel].sourceLinks[t].ty * 1000) / 1000, // distance to targetNode's top line
                                value: data.nodes[pointerOfLevel].sourceLinks[t].value,
                                directionAngle: Math.atan(
                                    (data.nodes[pointerOfLevel].sourceLinks[t].ty + data.nodes[pointerOfLevel].sourceLinks[t].target.y
                                        - data.nodes[pointerOfLevel].sourceLinks[t].sy - data.nodes[pointerOfLevel].sourceLinks[t].source.y)
                                    / (data.nodes[pointerOfLevel].sourceLinks[t].target.x - data.nodes[pointerOfLevel].sourceLinks[t].source.x)
                                ),
                                // directionAngle is radians, so we will keep use radian as the unit:
                                // 30 degrees == 0.523599 radians;
                                // 10 degrees == 0.174533 radians;
                                // 1 radians == 57.29578 radians;
                            })


                        // when starts a new cycle, we start from the place which we finished before
                        // at the same time, the list: nodeList[{}] shares the same order with data.nodes[pointerOfLevel].sourceLinks[{}]
                        let linkSequence = 0
                        while (linkSequence < nodeList.length && nodeList.length !== 0) {

                            // we set a brand new baseLine each time
                            let beginningNode = undefined
                            let endingNode = undefined

                            // Step3. clustering by angle
                            while (linkSequence < nodeList.length) {
                                // only have effect on current node once

                                // choose the first node as the beginningNode and search for the endingNode
                                beginningNode === undefined
                                    ? beginningNode = linkSequence
                                    : ""

                                endingNode = linkSequence

                                if (Math.abs(nodeList[endingNode].directionAngle - nodeList[beginningNode].directionAngle) > 0.323599) {
                                    // once this cycle break, we can get a cluster from [beginningNode to endingNode]
                                    // and at the same time, pointer linkSequence have arrived at the beginningNode in next cluster
                                    endingNode--
                                    break
                                }

                                linkSequence++
                                // if (linkSequence < nodeList.length - 1) linkSequence++
                                // else break // we have arrived at the last node
                            }

                            // console.log(nodeList.slice(beginningNode, endingNode+1))

                            // Step4. find the baseLine for this cluster
                            // find a line which can actually represent the direction for this cluster
                            // 30degrees == 0.523599radians; 90degrees == 1.570796radians; 1radians == 57.29578;
                            let baseLine = undefined
                            let maxAngle = (nodeList[beginningNode].directionAngle + nodeList[endingNode].directionAngle) / 2 + 0.174533
                            let minAngle = (nodeList[beginningNode].directionAngle + nodeList[endingNode].directionAngle) / 2 - 0.174533

                            for (let t = beginningNode; t <= endingNode; t++) {
                                if (nodeList[t].directionAngle >= minAngle && nodeList[t].directionAngle <= maxAngle)
                                    baseLine === undefined
                                        ? baseLine = data.nodes[pointerOfLevel].sourceLinks[t]
                                        : baseLine.dy < nodeList[t].dy
                                            ? baseLine = data.nodes[pointerOfLevel].sourceLinks[t]
                                            : ""
                            }

                            // change the standard of baseLine width here
                            const minimalBaseLineWidth = 0;

                            // Step5.
                            // remove the original paths and redraw the bundled path
                            if (baseLine === "" || baseLine === undefined)
                                // no links behind this node here and start next cycle
                                console.log("no links here or no standard lines")
                            else {
                                console.log(baseLine.source.name + "-" + baseLine.target.name)
                                let baseLineColor = document.getElementsByName(baseLine.source.name + "-" + baseLine.target.name)[0].style.stroke
                                document.getElementsByName(baseLine.source.name + "-" + baseLine.target.name)[0].style.strokeOpacity = "0.4"

                                // the cluster group
                                let group = svg.append("g")
                                    .attr("opacity", 0.2)

                                // 5.1 we do the redrawing actions first
                                // 5.1.1 check data
                                for (let t = beginningNode; t <= endingNode; t++) {
                                    console.log(baseLine)
                                    // we redraw these links
                                    let currentSourceNode = baseLine.source.sourceLinks[t].source
                                    let currentTargetNode = baseLine.source.sourceLinks[t].target
                                    let currentLineName = currentSourceNode.name + "-" + currentTargetNode.name
                                    let currentLine = document.getElementsByName(currentLineName)

                                    // nodeList是有序的！且其顺序正好与baseLine.source的sourceLinks的顺序完全一致
                                    // 所以完全可以直接采用
                                    for (let j = 0; j < currentLine.length; j++) {
                                        let nodeDistance = currentTargetNode.y - baseLine.target.y // the x(r) of expression
                                        const lorentzianA = 1
                                        const lorentzianB = 100
                                        nodeDistance = 1 - lorentzianA / (nodeDistance * nodeDistance + lorentzianB)　// the x(x) of expression
                                        let originalLineWidth = nodeList[t].dy // the y of expression

                                        // change the math expression here
                                        const alpha1 = 80;
                                        const beta1 = 0.;

                                        // the distance to target
                                        // to ensure that the dist is positive, do abs() function to nodeDistance
                                        let dist1 = 0
                                        nodeDistance > 0
                                            ? dist1 = alpha1 * nodeDistance + beta1 * originalLineWidth
                                            : dist1 = alpha1 * Math.abs(nodeDistance) + beta1 * originalLineWidth

                                        let minimalBundledLineWidth = 8

                                        let remainingWidth = nodeList[t].dy

                                        if (remainingWidth > minimalBundledLineWidth) {
                                            for (; remainingWidth > 0; remainingWidth = remainingWidth - minimalBundledLineWidth) {
                                                // first part of a line which starts from the source node
                                                // and continue to catch the baseline
                                                addLinksFromSource({
                                                    path: linkPathGeneratorFromSource({
                                                        source: baseLine.source,
                                                        target: {
                                                            name: baseLine.source.name,
                                                            x: baseLine.source.x + dist1 + baseLine.source.dx,
                                                            y: linkYSearchFromSource({
                                                                source: baseLine.source,
                                                                target: baseLine.target,
                                                                dy: baseLine.dy,
                                                                ty: baseLine.ty,
                                                                sy: baseLine.sy,
                                                                transformX: 0,
                                                                transformY: 0,//-nodeList[t].dy / 2 + baseLine.dy / 2,
                                                            }, baseLine.source.x + dist1 + baseLine.source.dx), // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                            dx: baseLine.source.dx,
                                                            dy: baseLine.source.dy,
                                                        },
                                                        dy: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                        ty: 0,
                                                        sy: nodeList[t].sy + nodeList[t].dy - remainingWidth,
                                                    }),
                                                    strokeWidth: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                    name: currentLineName + "-G1",
                                                    title: currentLineName + "-G1",
                                                }, true, baseLineColor, group)


                                                addLinksFromSource({
                                                    path: linkPathGeneratorFromSource({
                                                        source: {
                                                            name: nodeList[t].source.name,
                                                            x: baseLine.source.x + dist1,
                                                            y: linkYSearchFromSource({
                                                                // currentLineName: currentLineName,
                                                                source: baseLine.source,
                                                                target: baseLine.target,
                                                                dy: baseLine.dy,
                                                                ty: baseLine.ty,
                                                                sy: baseLine.sy,
                                                                transformX: 0,
                                                                transformY: 0,//-nodeList[t].dy / 2 + baseLine.dy / 2,//nodeList[t+nodeNumberAdder].sy - baseLine.sy,
                                                            }, baseLine.source.x + dist1 + baseLine.source.dx), // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                            dx: nodeList[t].source.dx,
                                                            dy: nodeList[t].source.dy,
                                                        },
                                                        target: nodeList[t].target,
                                                        dy: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                        ty: nodeList[t].ty + nodeList[t].dy - remainingWidth,
                                                        sy: 0,
                                                    }),
                                                    strokeWidth: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                    name: currentLineName + "-G2",
                                                    title: currentLineName + "-G2"
                                                }, true, baseLineColor, group)
                                            }
                                        } else {
                                            addLinksFromSource({
                                                path: linkPathGeneratorFromSource({
                                                    source: baseLine.source,
                                                    target: {
                                                        name: baseLine.source.name,
                                                        x: baseLine.source.x + dist1 + baseLine.source.dx,
                                                        y: linkYSearchFromSource({
                                                            source: baseLine.source,
                                                            target: baseLine.target,
                                                            dy: baseLine.dy,
                                                            ty: baseLine.ty,
                                                            sy: baseLine.sy,
                                                            transformX: 0,
                                                            transformY: 0,//-nodeList[t].dy / 2 + baseLine.dy / 2,
                                                        }, baseLine.source.x + dist1 + baseLine.source.dx), // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                        dx: baseLine.source.dx,
                                                        dy: baseLine.source.dy,
                                                    },
                                                    dy: nodeList[t].dy,
                                                    ty: 0,
                                                    sy: nodeList[t].sy,
                                                }),
                                                strokeWidth: nodeList[t].dy,
                                                name: currentLineName + "-G1",
                                                title: currentLineName + "-G1",
                                            }, true, baseLineColor, group)


                                            // second line, which will be divided and point to the real target
                                            addLinksFromSource({
                                                path: linkPathGeneratorFromSource({
                                                    source: {
                                                        name: nodeList[t].source.name,
                                                        x: baseLine.source.x + dist1,
                                                        y: linkYSearchFromSource({
                                                            // currentLineName: currentLineName,
                                                            source: baseLine.source,
                                                            target: baseLine.target,
                                                            dy: baseLine.dy,
                                                            ty: baseLine.ty,
                                                            sy: baseLine.sy,
                                                            transformX: 0,
                                                            transformY: 0,//-nodeList[t].dy / 2 + baseLine.dy / 2,//nodeList[t+nodeNumberAdder].sy - baseLine.sy,
                                                        }, baseLine.source.x + dist1 + baseLine.source.dx), // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                        dx: nodeList[t].source.dx,
                                                        dy: nodeList[t].source.dy,
                                                    },
                                                    target: nodeList[t].target,
                                                    dy: nodeList[t].dy,
                                                    ty: nodeList[t].ty,
                                                    sy: 0,
                                                }),
                                                strokeWidth: nodeList[t].dy,
                                                name: currentLineName + "-G2",
                                                title: currentLineName + "-G2"
                                            }, true, baseLineColor, group)
                                        }

                                        // 5.2 do remove to original paths
                                        currentLine[j].remove()
                                        if (j >= 1) t++
                                    }

                                    function linkPathGeneratorFromSource(d) {
                                        let curvature = 0.5;

                                        function link(d) {
                                            const x0 = d.source.x + d.source.dx;
                                            const x1 = d.target.x;
                                            const x2 = Math.floor((x0 * (1 - curvature) + x1 * curvature) * 1000) / 1000;
                                            const x3 = Math.floor((x0 * curvature + x1 * (1 - curvature)) * 1000) / 1000;
                                            const y0 = Math.floor((d.source.y + d.sy + d.dy / 2) * 1000) / 1000;
                                            const y1 = Math.floor((d.target.y + d.ty + d.dy / 2) * 1000) / 1000;
                                            return "M" + x0 + "," + y0 + "C" + x2 + "," + y0 + " " + x3 + "," + y1 + " " + x1 + "," + y1;
                                        }

                                        return link(d)
                                    }

                                    // 求解这条曲线所截点的Y坐标，用中值来搜索
                                    function linkYSearchFromSource(firstLine, positionXS) {
                                        let curvature = 0.5;
                                        // 还原原先的控制线与端点
                                        const x0 = firstLine.source.x + firstLine.source.dx; // 起始点 x
                                        const x3 = firstLine.target.x; // 终点 x
                                        const xi = d3.interpolateNumber(x0, x3);
                                        const x1 = xi(curvature); // 控制点1 x
                                        const x2 = xi(1 - curvature); // 控制点2 x
                                        const y0 = firstLine.source.y + firstLine.sy + firstLine.dy / 2// + firstLine.transformY;
                                        const y3 = firstLine.target.y + firstLine.ty + firstLine.dy / 2// + firstLine.transformY;
                                        const y1 = y0;
                                        const y2 = y3;

                                        let max = 1
                                        let min = 0
                                        let t = 0.5 // search starts from the middle, 50% per time
                                        let positionX = 0
                                        let positionY = 0
                                        // 进行search
                                        while (true) {
                                            positionX =
                                                x0 * (1 - t) * (1 - t) * (1 - t)
                                                + 3 * x1 * t * (1 - t) * (1 - t)
                                                + 3 * x2 * t * t * (1 - t)
                                                + x3 * t * t * t

                                            if (positionX - positionXS < 0.00001 && positionXS - positionX < 0.00001) {
                                                positionY =
                                                    y0 * (1 - t) * (1 - t) * (1 - t)
                                                    + 3 * y1 * t * (1 - t) * (1 - t)
                                                    + 3 * y2 * t * t * (1 - t)
                                                    + y3 * t * t * t
                                                break
                                            } else {
                                                if (positionX > positionXS)
                                                    max = t
                                                else if (positionX < positionXS)
                                                    min = t
                                                t = (max + min) / 2
                                            }
                                        }

                                        return positionY// - firstLine.dy / 2 + firstLine.transformY
                                    }

                                    function addLinksFromSource(pathData, isRealLine, baseLineColor, group) {
                                        if (isRealLine === true) // the line that point to the real node
                                            svg.append("g")
                                                .append("path")
                                                .attr("class", "link")
                                                .attr("d", pathData.path)
                                                .attr("name", pathData.name)
                                                .style("stroke-width", Math.max(1, pathData.strokeWidth))
                                                .style("stroke", baseLineColor)
                                                .append("title")
                                                .text(pathData.title)
                                        else {// the line that point to the baseLine node
                                            svg.append("g")
                                                .append("path")
                                                .attr("class", "link")
                                                .attr("d", pathData.path)
                                                .attr("name", pathData.name)
                                                .attr("transform", `translate(${pathData.transformX}, ${pathData.transformY})`)
                                                .style("stroke-width", Math.max(1, pathData.strokeWidth))
                                                .style("clip-path", pathData.clipPath)
                                                .style("stroke", baseLineColor)
                                                .append("title")
                                                .text(pathData.title)
                                        }
                                    }
                                }
                            }
                        }
                    }
                } else {
                    // bundling From Target
                    let startNodeIndex = 0
                    let endNodeIndex = 0
                    level.forEach(element => {
                        if (level.indexOf(element) <= i) startNodeIndex += element.length
                        if (level.indexOf(element) <= i + 1) endNodeIndex += element.length
                    })

                    for (let pointerOfLevel = startNodeIndex; pointerOfLevel < endNodeIndex; pointerOfLevel++) {
                        // Step2.
                        // prepare for redrawing the path
                        // cycling in the targetLinks list of current node to find the baseLine
                        let nodeList = [];
                        for (let t = 0; t < data.nodes[pointerOfLevel].targetLinks.length; t++)
                            // check all the info on this node at once
                            // we will make slice about it later
                            nodeList.push({
                                linkName: data.nodes[pointerOfLevel].targetLinks[t].source.name + '-' + data.nodes[pointerOfLevel].targetLinks[t].target.name,
                                source: {
                                    name: data.nodes[pointerOfLevel].targetLinks[t].source.name,
                                    x: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].source.x * 1000) / 1000, // node left line position
                                    y: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].source.y * 1000) / 1000, // node top line position
                                    dx: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].source.dx * 1000) / 1000, // node width
                                    dy: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].source.dy * 1000) / 1000, // node height
                                },
                                target: {
                                    name: data.nodes[pointerOfLevel].targetLinks[t].target.name,
                                    x: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].target.x * 1000) / 1000, // node left line position
                                    y: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].target.y * 1000) / 1000, // node top line position
                                    dx: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].target.dx * 1000) / 1000, // node width
                                    dy: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].target.dy * 1000) / 1000, // node height
                                },
                                dy: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].dy * 1000) / 1000, // stoke-width
                                sy: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].sy * 1000) / 1000, // distance to sourceNode's top line
                                ty: Math.floor(data.nodes[pointerOfLevel].targetLinks[t].ty * 1000) / 1000, // distance to targetNode's top line
                                value: data.nodes[pointerOfLevel].targetLinks[t].value,
                                directionAngle: Math.atan(
                                    (data.nodes[pointerOfLevel].targetLinks[t].ty + data.nodes[pointerOfLevel].targetLinks[t].target.y
                                        - data.nodes[pointerOfLevel].targetLinks[t].sy - data.nodes[pointerOfLevel].targetLinks[t].source.y)
                                    / (data.nodes[pointerOfLevel].targetLinks[t].target.x - data.nodes[pointerOfLevel].targetLinks[t].source.x)
                                ),
                                // directionAngle is radians, so we will keep use radian as the unit:
                                // 30 degrees == 0.523599 radians;
                                // 10 degrees == 0.174533 radians;
                                // 1 radians == 57.29578 radians;
                            })

                        console.log(nodeList)
                        // when starts a new cycle, we start from the place which we finished before
                        // at the same time, the list: nodeList[{}] shares the same order with data.nodes[pointerOfLevel].sourceLinks[{}]
                        let linkSequence = 0
                        while (linkSequence < nodeList.length - 1 && nodeList.length !== 0) {

                            // we set a brand new baseLine each time
                            let beginningNode = undefined
                            let endingNode = undefined

                            // Step3. clustering by angle
                            while (true) {
                                // only have effect on current node once

                                // choose the first node as the beginningNode and search for the endingNode
                                beginningNode === undefined
                                    ? beginningNode = linkSequence
                                    : ""

                                endingNode = linkSequence

                                if (Math.abs(nodeList[endingNode].directionAngle - nodeList[beginningNode].directionAngle) > 0.323599) {
                                    // once this cycle break, we can get a cluster from [beginningNode 4to endingNode]
                                    // and at the same time, pointer linkSequence have arrived at the beginningNode in next cluster
                                    endingNode--
                                    break
                                }

                                // current "endingNode" may not be the really endingNode
                                if (linkSequence < nodeList.length - 1)
                                    linkSequence++
                                else
                                    break // we have arrived at the last node
                            }
                            console.log(nodeList.slice(beginningNode, endingNode + 1))

                            // Step4. find the baseLine for this cluster
                            // find a line which can actually represent the direction for this cluster
                            // 30degrees == 0.523599radians; 90degrees == 1.570796radians; 1radians == 57.29578;
                            let baseLine = undefined
                            let maxAngle = (nodeList[beginningNode].directionAngle + nodeList[endingNode].directionAngle) / 2 + 0.274533
                            let minAngle = (nodeList[beginningNode].directionAngle + nodeList[endingNode].directionAngle) / 2 - 0.274533

                            for (let t = beginningNode; t <= endingNode; t++) {
                                if (nodeList[t].directionAngle >= minAngle && nodeList[t].directionAngle <= maxAngle)
                                    baseLine === undefined
                                        ? baseLine = data.nodes[pointerOfLevel].targetLinks[t]
                                        : baseLine.dy < nodeList[t].dy
                                            ? baseLine = data.nodes[pointerOfLevel].targetLinks[t]
                                            : ""
                            }

                            // change the standard of baseLine width here
                            const minimalBaseLineWidth = 0;

                            // Step5.
                            // remove the original paths and redraw the bundled path
                            if (baseLine === "" || baseLine === undefined)
                                // no links behind this node here and start next cycle
                                console.log("no links here or no standard lines")
                            else {
                                console.log(baseLine.source.name + "-" + baseLine.target.name)
                                let baseLineColor = document.getElementsByName(baseLine.source.name + "-" + baseLine.target.name)[0].style.stroke
                                document.getElementsByName(baseLine.source.name + "-" + baseLine.target.name)[0].style.strokeOpacity = "0.4"

                                // the cluster group
                                let group = svg.append("g")
                                    .attr("opacity", 0.2)

                                // 5.1 we do the redrawing actions first
                                // 5.1.1 check data
                                for (let t = beginningNode; t <= endingNode; t++) {
                                    // console.log(baseLine)
                                    // we redraw these links
                                    let currentSourceNode = baseLine.target.targetLinks[t].source
                                    let currentTargetNode = baseLine.target.targetLinks[t].target
                                    let currentLineName = currentSourceNode.name + "-" + currentTargetNode.name
                                    let currentLine = document.getElementsByName(currentLineName)

                                    // nodeList has a order which is same to targetLinks
                                    for (let j = 0; j < currentLine.length; j++) {
                                        let nodeDistance = currentTargetNode.y - baseLine.target.y // the x(r) of expression
                                        const lorentzianA = 1
                                        const lorentzianB = 100
                                        nodeDistance = 1 - lorentzianA / (nodeDistance * nodeDistance + lorentzianB)　// the x(x) of expression
                                        let originalLineWidth = nodeList[t].dy // the y of expression

                                        let alpha1 = 70
                                        // change the math expression here
                                        i === 0 ? alpha1 = 50 : alpha1 = 50
                                        // // change the math expression here
                                        // i === 0 || i === 1 ? alpha1 = 130 : alpha1 = 220
                                        const beta1 = 0.;

                                        // the distance to target
                                        // to ensure that the dist1 is positive, do abs() function to nodeDistance
                                        let dist1 = 0
                                        nodeDistance > 0
                                            ? dist1 = alpha1 * nodeDistance + beta1 * originalLineWidth
                                            : dist1 = alpha1 * Math.abs(nodeDistance) + beta1 * originalLineWidth

                                        let remainingWidth = nodeList[t].dy

                                        let minimalBundledLineWidth = 8

                                        let tempY = linkYSearchFromTarget({
                                                                source: baseLine.source,
                                                                target: baseLine.target,
                                                                dy: baseLine.dy,
                                                                ty: baseLine.ty,
                                                                sy: baseLine.sy,
                                                                transformX: 0,
                                                                transformY: +nodeList[t].dy / 2 - baseLine.dy / 2,
                                                            }, baseLine.source.x + dist1 + baseLine.source.dx)
                                        if (remainingWidth > minimalBundledLineWidth) {

                                            for (; remainingWidth > 0; remainingWidth = remainingWidth - minimalBundledLineWidth) {
                                                // add links actions, which is opposite to the above one
                                                addLinksFromTarget({
                                                    path: linkPathGeneratorFromTarget({
                                                        source: nodeList[t].source,
                                                        target: {
                                                            name: baseLine.source.name,
                                                            x: baseLine.source.x + dist1 + baseLine.source.dx,
                                                            y: tempY, // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                            dx: baseLine.source.dx,
                                                            dy: baseLine.source.dy,
                                                        },
                                                        dy: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                        ty: 0,
                                                        sy: nodeList[t].sy + nodeList[t].dy - remainingWidth
                                                    }),
                                                    strokeWidth: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                    name: `${nodeList[t].source.name}-${nodeList[t].target.name}-G1`,
                                                    title: `${nodeList[t].source.name}-${nodeList[t].target.name}-G1`,
                                                }, true, baseLineColor, group) // first line, which shows with the baseline


                                                addLinksFromTarget({
                                                    path: linkPathGeneratorFromTarget({
                                                        source: {
                                                            name: baseLine.source.name,
                                                            x: baseLine.source.x + dist1,
                                                            y: tempY, // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                            dx: baseLine.source.dx,
                                                            dy: baseLine.source.dy,
                                                        },
                                                        target: nodeList[t].target,
                                                        //baseLine.target,
                                                        dy: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                        ty: nodeList[t].ty + nodeList[t].dy - remainingWidth,
                                                        sy: 0,
                                                    }),
                                                    strokeWidth: remainingWidth < minimalBundledLineWidth ? remainingWidth : minimalBundledLineWidth,
                                                    name: `${nodeList[t].source.name}-${nodeList[t].target.name}-G2`,
                                                    title: `${nodeList[t].source.name}-${nodeList[t].target.name}-G2`,
                                                }, true, baseLineColor, group)
                                            }
                                        } else {
                                            // add links actions, which is opposite to the above one
                                            addLinksFromTarget({
                                                path: linkPathGeneratorFromTarget({
                                                    source: nodeList[t].source,
                                                    target: {
                                                        name: baseLine.source.name,
                                                        x: baseLine.source.x + dist1 + baseLine.source.dx,
                                                        y: tempY, // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                        dx: baseLine.source.dx,
                                                        dy: baseLine.source.dy,
                                                    },
                                                    dy: nodeList[t].dy,
                                                    sy: nodeList[t].sy,
                                                    ty: 0
                                                }),
                                                strokeWidth: nodeList[t].dy,
                                                name: `${nodeList[t].source.name}-${nodeList[t].target.name}-G1`,
                                                title: `${nodeList[t].source.name}-${nodeList[t].target.name}-G1`,
                                            }, true, baseLineColor, group) // first line, which shows with the baseline


                                            addLinksFromTarget({
                                                path: linkPathGeneratorFromTarget({
                                                    source: {
                                                        name: baseLine.source.name,
                                                        x: baseLine.source.x + dist1,
                                                        y: tempY, // 在绑线上搜索dist所截下的对应x坐标下的Y坐标
                                                        dx: baseLine.source.dx,
                                                        dy: baseLine.source.dy,
                                                    },
                                                    target: nodeList[t].target,
                                                    //baseLine.target,
                                                    dy: nodeList[t].dy,
                                                    sy: 0,
                                                    ty: nodeList[t].ty
                                                }),
                                                strokeWidth: nodeList[t].dy,
                                                name: `${nodeList[t].source.name}-${nodeList[t].target.name}-G2`,
                                                title: `${nodeList[t].source.name}-${nodeList[t].target.name}-G2`,
                                            }, true, baseLineColor, group)
                                        }

                                        // 5.2 do remove to original paths
                                        currentLine[j].remove()
                                        if (j >= 1) t++
                                    }

                                    // 求解这条曲线所截点的Y坐标，用中值来搜索
                                    function linkYSearchFromTarget(firstLine, positionXS) {
                                        let curvature = 0.5;
                                        // 还原原先的控制线与端点
                                        const x0 = firstLine.source.x + firstLine.source.dx; // 起始点 x
                                        const x3 = firstLine.target.x; // 终点 x
                                        const xi = d3.interpolateNumber(x0, x3);
                                        const x1 = xi(curvature); // 控制点1 x
                                        const x2 = xi(1 - curvature); // 控制点2 x
                                        const y0 = firstLine.source.y + firstLine.sy + firstLine.dy / 2// + firstLine.transformY;
                                        const y3 = firstLine.target.y + firstLine.ty + firstLine.dy / 2// + firstLine.transformY;
                                        const y1 = y0;
                                        const y2 = y3;

                                        let max = 1
                                        let min = 0
                                        let t = 0.5 // search starts from the middle, 50% per time
                                        let positionX = 0
                                        let positionY = 0
                                        // 进行search
                                        while (true) {
                                            positionX =
                                                x0 * (1 - t) * (1 - t) * (1 - t)
                                                + 3 * x1 * t * (1 - t) * (1 - t)
                                                + 3 * x2 * t * t * (1 - t)
                                                + x3 * t * t * t

                                            if (positionX - positionXS < 0.00001 && positionXS - positionX < 0.00001) {
                                                positionY =
                                                    y0 * (1 - t) * (1 - t) * (1 - t)
                                                    + 3 * y1 * t * (1 - t) * (1 - t)
                                                    + 3 * y2 * t * t * (1 - t)
                                                    + y3 * t * t * t
                                                break
                                            } else {
                                                if (positionX > positionXS)
                                                    max = t
                                                else if (positionX < positionXS)
                                                    min = t
                                                t = (max + min) / 2
                                            }
                                        }

                                        return positionY// - firstLine.dy / 2 + firstLine.transformY
                                    }

                                    function linkPathGeneratorFromTarget(d) {
                                        let curvature = 0.5;

                                        function link(d) {
                                            const x0 = d.source.x + d.source.dx;
                                            const x1 = d.target.x;
                                            const x2 = Math.floor((x0 * (1 - curvature) + x1 * curvature) * 1000) / 1000;
                                            const x3 = Math.floor((x0 * curvature + x1 * (1 - curvature)) * 1000) / 1000;
                                            const y0 = Math.floor((d.source.y + d.sy + d.dy / 2) * 1000) / 1000;
                                            const y1 = Math.floor((d.target.y + d.ty + d.dy / 2) * 1000) / 1000;
                                            return "M" + x0 + "," + y0 + "C" + x2 + "," + y0 + " " + x3 + "," + y1 + " " + x1 + "," + y1;
                                        }

                                        return link(d)
                                    }

                                    function addLinksFromTarget(pathData, isRealLine, baseLineColor, group) {
                                        if (isRealLine === true) // the line that point to the real node
                                            svg.append("g")
                                                .append("path")
                                                .attr("class", "link")
                                                .attr("d", pathData.path)
                                                .attr("name", pathData.name)
                                                .style("stroke-width", Math.max(1, pathData.strokeWidth))
                                                .style("stroke", baseLineColor)
                                                // .style("stroke-opacity", "0.2")
                                                .append("title")
                                                .text(pathData.title)
                                        else // the line that point to the baseLine node
                                            svg.append("g")
                                                .append("path")
                                                .attr("class", "link")
                                                .attr("d", pathData.path)
                                                .attr("name", pathData.name)
                                                .style("stroke-width", Math.max(1, pathData.strokeWidth))
                                                .style("clip-path", pathData.clipPath)
                                                .style("stroke", baseLineColor)
                                                // .style("stroke-opacity", "0.5")
                                                .append("title")
                                                .text(pathData.title)
                                    }

                                }
                            }
                        }

                    }
                    console.log("--------one turn--------")
                }
            }
        }

        console.log("---------bundlingMethode Start!---------")
        bundlingMethod(data)
        console.log("---------bundlingMethode Over!---------")

    </script>

</body>

</html>